{
  "hash": "532c2224af0f2eb3be77a17a52abf242",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Integer Hyperparameters in Tuners for Real-valued Search Spaces\ncategories:\n  - tuning\n  - classification\nauthor:\n  - name: Marc Becker\ndescription: |\n  Optimize integer hyperparameters with tuners that can only propose real numbers.\ndate: 01-19-2021\naliases:\n  - ../../../gallery/2021-01-19-integer-hyperparameters-in-tuners-for-real-valued-search-spaces/index.html\n---\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrequireNamespace(\"kknn\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required namespace: kknn\n```\n\n\n:::\n:::\n\n\n\n## Introduction\n\n[`Tuner`](https://mlr3tuning.mlr-org.com/reference/Tuner.html) for real-valued search spaces are not able to tune on integer hyperparameters.\nHowever, it is possible to round the real values proposed by a [`Tuner`](https://mlr3tuning.mlr-org.com/reference/Tuner.html) to integers before passing them to the learner in the evaluation.\nWe show how to apply a parameter transformation to a [`ParamSet`](https://paradox.mlr-org.com/reference/ParamSet.html) and use this set in the tuning process.\n\nWe load the [mlr3verse](https://mlr3verse.mlr-org.com) package which pulls in the most important packages for this example.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(mlr3verse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: mlr3\n```\n\n\n:::\n:::\n\n\n\nWe initialize the random number generator with a fixed seed for reproducibility, and decrease the verbosity of the logger to keep the output clearly represented.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nset.seed(7832)\nlgr::get_logger(\"mlr3\")$set_threshold(\"warn\")\nlgr::get_logger(\"bbotk\")$set_threshold(\"warn\")\n```\n:::\n\n\n\n## Task and Learner\n\nIn this example, we use the k-Nearest-Neighbor classification learner.\nWe want to tune the integer-valued hyperparameter `k` which defines the numbers of neighbors.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlearner = lrn(\"classif.kknn\")\nprint(learner$param_set$params$k)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNULL\n```\n\n\n:::\n:::\n\n\n\n# Tuning\n\nWe choose generalized simulated annealing as tuning strategy.\nThe `param_classes` field of [`TunerBatchGenSA`](https://mlr3tuning.mlr-org.com/reference/mlr_tuners_gensa.html) states that the tuner only supports real-valued (`ParamDbl`) hyperparameter tuning.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprint(tnr(\"gensa\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<TunerBatchGenSA>: Generalized Simulated Annealing\n* Parameters: smooth=FALSE\n* Parameter classes: ParamDbl\n* Properties: single-crit\n* Packages: mlr3tuning, bbotk, GenSA\n```\n\n\n:::\n:::\n\n\n\nTo get integer-valued hyperparameter values for `k`, we construct a search space with a transformation function.\nThe `as.integer()` function converts any real valued number to an integer by removing the decimal places.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsearch_space = ps(\n  k = p_dbl(lower = 3, upper = 7.99, trafo = as.integer)\n)\n```\n:::\n\n\n\nWe start the tuning and compare the results of the search space to the results in the space of the learners hyperparameter set.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ninstance = tune(\n  tuner = tnr(\"gensa\"),\n  task = tsk(\"iris\"),\n  learner = learner,\n  resampling = rsmp(\"holdout\"),\n  measure = msr(\"classif.ce\"),\n  term_evals = 20,\n  search_space = search_space)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in optim(theta.old, fun, gradient, control = control, method = method, : one-dimensional optimization by Nelder-Mead is unreliable:\nuse \"Brent\" or optimize() directly\n```\n\n\n:::\n:::\n\n\n\nThe optimal `k` is still a real number in the search space.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ninstance$result_x_search_space\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         k\n     <num>\n1: 3.82686\n```\n\n\n:::\n:::\n\n\n\nHowever, in the learners hyperparameters space, `k` is an integer value.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ninstance$result_x_domain\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$k\n[1] 3\n```\n\n\n:::\n:::\n\n\n\nThe archive shows us that for all real-valued `k` proposed by [GenSA](https://cran.r-project.org/package=GenSA), an integer-valued `k` in the learner hyperparameter space (`x_domain_k`) was created.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nas.data.table(instance$archive)[, .(k, classif.ce, x_domain_k)]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           k classif.ce x_domain_k\n       <num>      <num>      <int>\n 1: 3.826860       0.06          3\n 2: 5.996323       0.06          5\n 3: 5.941332       0.06          5\n 4: 3.826860       0.06          3\n 5: 3.826860       0.06          3\n 6: 3.826860       0.06          3\n 7: 4.209546       0.06          4\n 8: 3.444174       0.06          3\n 9: 4.018203       0.06          4\n10: 3.635517       0.06          3\n11: 3.922532       0.06          3\n12: 3.731189       0.06          3\n13: 3.874696       0.06          3\n14: 3.779024       0.06          3\n15: 3.850778       0.06          3\n16: 3.802942       0.06          3\n17: 3.838819       0.06          3\n18: 3.814901       0.06          3\n19: 3.832840       0.06          3\n20: 3.820881       0.06          3\n           k classif.ce x_domain_k\n```\n\n\n:::\n:::\n\n\n\nInternally, [`TunerBatchGenSA`](https://mlr3tuning.mlr-org.com/reference/mlr_tuners_gensa.html) was given the parameter types of the search space and therefore suggested real numbers for `k`.\nBefore the performance of the different `k` values was evaluated, the transformation function of the `search_space` parameter set was called and `k` was transformed to an integer value.\n\nNote that the tuner is not aware of the transformation.\nThis has two problematic consequences:\nFirst, the tuner might propose different real valued configurations that after rounding end up to be already evaluated configurations and we end up with re-evaluating the same hyperparameter configuration.\nThis is only problematic, if we only optimze integer parameters.\nSecond, the rounding introduces discontinuities which can be problematic for some tuners.\n\nWe successfully tuned a integer-valued hyperparameter with [`TunerBatchGenSA`](https://mlr3tuning.mlr-org.com/reference/mlr_tuners_gensa.html) which is only suitable for an real-valued search space.\nThis technique is not limited to tuning problems.\n[`Optimizer`](https://bbotk.mlr-org.com/reference/Optimizer.html) in [bbotk](https://bbotk.mlr-org.com) can be also used in the same way to produce points with integer parameters.\n\n\n# Session Information\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsessioninfo::session_info(info = \"packages\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n═ Session info ═══════════════════════════════════════════════════════════════════════════════════════════════════════\n─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────\n ! package           * version    date (UTC) lib source\n   backports           1.5.0      2024-05-23 [1] CRAN (R 4.4.1)\n   bbotk               1.1.1      2024-10-15 [1] CRAN (R 4.4.1)\n   checkmate           2.3.2      2024-07-29 [1] CRAN (R 4.4.1)\n P class               7.3-22     2023-05-03 [?] CRAN (R 4.4.0)\n   cli                 3.6.3      2024-06-21 [1] CRAN (R 4.4.1)\n   clue                0.3-65     2023-09-23 [1] CRAN (R 4.4.1)\n P cluster             2.1.6      2023-12-01 [?] CRAN (R 4.4.0)\n P codetools           0.2-20     2024-03-31 [?] CRAN (R 4.4.0)\n   colorspace          2.1-1      2024-07-26 [1] CRAN (R 4.4.1)\n   crayon              1.5.3      2024-06-20 [1] CRAN (R 4.4.1)\n   data.table        * 1.16.2     2024-10-10 [1] CRAN (R 4.4.1)\n   DEoptimR            1.1-3      2023-10-07 [1] CRAN (R 4.4.1)\n   digest              0.6.37     2024-08-19 [1] CRAN (R 4.4.1)\n   diptest             0.77-1     2024-04-10 [1] CRAN (R 4.4.1)\n   dplyr               1.1.4      2023-11-17 [1] CRAN (R 4.4.1)\n   evaluate            1.0.1      2024-10-10 [1] CRAN (R 4.4.1)\n   fansi               1.0.6      2023-12-08 [1] CRAN (R 4.4.1)\n   fastmap             1.2.0      2024-05-15 [1] CRAN (R 4.4.1)\n   flexmix             2.3-19     2023-03-16 [1] CRAN (R 4.4.1)\n   fpc                 2.2-13     2024-09-24 [1] CRAN (R 4.4.1)\n   future              1.34.0     2024-07-29 [1] CRAN (R 4.4.1)\n   future.apply        1.11.2     2024-03-28 [1] CRAN (R 4.4.1)\n   generics            0.1.3      2022-07-05 [1] CRAN (R 4.4.1)\n   GenSA               1.1.14.1   2024-09-21 [1] CRAN (R 4.4.1)\n   ggplot2             3.5.1      2024-04-23 [1] CRAN (R 4.4.1)\n   globals             0.16.3     2024-03-08 [1] CRAN (R 4.4.1)\n   glue                1.8.0      2024-09-30 [1] CRAN (R 4.4.1)\n   gtable              0.3.5      2024-04-22 [1] CRAN (R 4.4.1)\n   htmltools           0.5.8.1    2024-04-04 [1] CRAN (R 4.4.1)\n   htmlwidgets         1.6.4      2023-12-06 [1] CRAN (R 4.4.1)\n   igraph              2.0.3      2024-03-13 [1] CRAN (R 4.4.1)\n   jsonlite            1.8.9      2024-09-20 [1] CRAN (R 4.4.1)\n   kernlab             0.9-33     2024-08-13 [1] CRAN (R 4.4.1)\n   kknn                1.3.1      2016-03-26 [1] CRAN (R 4.4.1)\n   knitr               1.48       2024-07-07 [1] CRAN (R 4.4.1)\n P lattice             0.22-5     2023-10-24 [?] CRAN (R 4.3.3)\n   lgr                 0.4.4      2022-09-05 [1] CRAN (R 4.4.1)\n   lifecycle           1.0.4      2023-11-07 [1] CRAN (R 4.4.1)\n   listenv             0.9.1      2024-01-29 [1] CRAN (R 4.4.1)\n   magrittr            2.0.3      2022-03-30 [1] CRAN (R 4.4.1)\n P MASS                7.3-61     2024-06-13 [?] CRAN (R 4.4.1)\n P Matrix              1.7-0      2024-04-26 [?] CRAN (R 4.4.0)\n   mclust              6.1.1      2024-04-29 [1] CRAN (R 4.4.1)\n   mlr3              * 0.21.1     2024-10-18 [1] CRAN (R 4.4.1)\n   mlr3cluster         0.1.10     2024-10-03 [1] CRAN (R 4.4.1)\n   mlr3data            0.7.0      2023-06-29 [1] CRAN (R 4.4.1)\n   mlr3extralearners   0.9.0-9000 2024-10-18 [1] Github (mlr-org/mlr3extralearners@a622524)\n   mlr3filters         0.8.0      2024-04-10 [1] CRAN (R 4.4.1)\n   mlr3fselect         1.1.1.9000 2024-10-18 [1] Github (mlr-org/mlr3fselect@e917a02)\n   mlr3hyperband       0.6.0      2024-06-29 [1] CRAN (R 4.4.1)\n   mlr3learners        0.7.0      2024-06-28 [1] CRAN (R 4.4.1)\n   mlr3mbo             0.2.6      2024-10-16 [1] CRAN (R 4.4.1)\n   mlr3measures        1.0.0      2024-09-11 [1] CRAN (R 4.4.1)\n   mlr3misc            0.15.1     2024-06-24 [1] CRAN (R 4.4.1)\n   mlr3pipelines       0.7.0      2024-09-24 [1] CRAN (R 4.4.1)\n   mlr3tuning          1.0.2      2024-10-14 [1] CRAN (R 4.4.1)\n   mlr3tuningspaces    0.5.1      2024-06-21 [1] CRAN (R 4.4.1)\n   mlr3verse         * 0.3.0      2024-06-30 [1] CRAN (R 4.4.1)\n   mlr3viz             0.9.0      2024-07-01 [1] CRAN (R 4.4.1)\n   mlr3website       * 0.0.0.9000 2024-10-18 [1] Github (mlr-org/mlr3website@20d1ddf)\n   modeltools          0.2-23     2020-03-05 [1] CRAN (R 4.4.1)\n   munsell             0.5.1      2024-04-01 [1] CRAN (R 4.4.1)\n P nnet                7.3-19     2023-05-03 [?] CRAN (R 4.3.3)\n   palmerpenguins      0.1.1      2022-08-15 [1] CRAN (R 4.4.1)\n   paradox             1.0.1      2024-07-09 [1] CRAN (R 4.4.1)\n   parallelly          1.38.0     2024-07-27 [1] CRAN (R 4.4.1)\n   pillar              1.9.0      2023-03-22 [1] CRAN (R 4.4.1)\n   pkgconfig           2.0.3      2019-09-22 [1] CRAN (R 4.4.1)\n   prabclus            2.3-4      2024-09-24 [1] CRAN (R 4.4.1)\n   R6                  2.5.1      2021-08-19 [1] CRAN (R 4.4.1)\n   Rcpp                1.0.13     2024-07-17 [1] CRAN (R 4.4.1)\n   renv                1.0.11     2024-10-12 [1] CRAN (R 4.4.1)\n   rlang               1.1.4      2024-06-04 [1] CRAN (R 4.4.1)\n   rmarkdown           2.28       2024-08-17 [1] CRAN (R 4.4.1)\n   robustbase          0.99-4-1   2024-09-27 [1] CRAN (R 4.4.1)\n   scales              1.3.0      2023-11-28 [1] CRAN (R 4.4.1)\n   sessioninfo         1.2.2      2021-12-06 [1] CRAN (R 4.4.1)\n   spacefillr          0.3.3      2024-05-22 [1] CRAN (R 4.4.1)\n   stringi             1.8.4      2024-05-06 [1] CRAN (R 4.4.1)\n   tibble              3.2.1      2023-03-20 [1] CRAN (R 4.4.1)\n   tidyselect          1.2.1      2024-03-11 [1] CRAN (R 4.4.1)\n   utf8                1.2.4      2023-10-22 [1] CRAN (R 4.4.1)\n   uuid                1.2-1      2024-07-29 [1] CRAN (R 4.4.1)\n   vctrs               0.6.5      2023-12-01 [1] CRAN (R 4.4.1)\n   withr               3.0.1      2024-07-31 [1] CRAN (R 4.4.1)\n   xfun                0.48       2024-10-03 [1] CRAN (R 4.4.1)\n   yaml                2.3.10     2024-07-26 [1] CRAN (R 4.4.1)\n\n [1] /home/marc/repositories/mlr3website/mlr-org/renv/library/linux-ubuntu-noble/R-4.4/x86_64-pc-linux-gnu\n [2] /home/marc/.cache/R/renv/sandbox/linux-ubuntu-noble/R-4.4/x86_64-pc-linux-gnu/9a444a72\n\n P ── Loaded and on-disk path mismatch.\n\n──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}