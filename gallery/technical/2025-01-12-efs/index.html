<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="John Zobolas">
<meta name="dcterms.date" content="2025-01-12">
<meta name="description" content="Find the most stable and predictive features using multiple learners and resampling techniques.">

<title>Wrapper-based Ensemble Feature Selection – mlr-org</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-1fa5e93acb50773330e542bbd58c1e25.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 2,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 5,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">mlr-org</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-overview" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Overview</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-overview">    
        <li>
    <a class="dropdown-item" href="../../../ecosystem.html">
 <span class="dropdown-text">Ecosystem</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../dependencies.html">
 <span class="dropdown-text">Dependencies</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../../tasks.html">
 <span class="dropdown-text">Tasks</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../learners.html">
 <span class="dropdown-text">Learners</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../resamplings.html">
 <span class="dropdown-text">Resamplings</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../measures.html">
 <span class="dropdown-text">Measures</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../../pipeops.html">
 <span class="dropdown-text">Pipeline Operators</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../graphs.html">
 <span class="dropdown-text">Graphs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../torch_pipeops.html">
 <span class="dropdown-text">Torch Pipeline Operators</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../../tuners.html">
 <span class="dropdown-text">Tuners</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../tuning_spaces.html">
 <span class="dropdown-text">Tuning Spaces</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../terminators.html">
 <span class="dropdown-text">Terminators</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../../filters.html">
 <span class="dropdown-text">Feature Selection Filter</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../fselectors.html">
 <span class="dropdown-text">Feature Selection Wrapper</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../book.html"> 
<span class="menu-text">Book</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../gallery.html"> 
<span class="menu-text">Gallery</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-benchmarks" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Benchmarks</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-benchmarks">    
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_mlr3.html">
 <span class="dropdown-text">mlr3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_mlr3fselect.html">
 <span class="dropdown-text">mlr3fselect</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_mlr3tuning.html">
 <span class="dropdown-text">mlr3tuning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_async.html">
 <span class="dropdown-text">mlr3tuning async</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmark_rush.html">
 <span class="dropdown-text">rush</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_paradox.html">
 <span class="dropdown-text">paradox</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../team.html"> 
<span class="menu-text">Team</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-more" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">More</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-more">    
        <li>
    <a class="dropdown-item" href="../../../support.html">
 <span class="dropdown-text">Support</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contributing.html">
 <span class="dropdown-text">Contributing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../faq.html">
 <span class="dropdown-text">Frequently Asked Questions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../blogroll.html">
 <span class="dropdown-text">Blogroll</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-rss" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-rss">    
        <li>
    <a class="dropdown-item" href="../../../gallery-all.xml">
 <span class="dropdown-text">Gallery RSS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite"> <i class="bi bi-chat-dots" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://stackoverflow.com/questions/tagged/mlr3"> <i class="bi bi-stack-overflow" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mlr-org"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Wrapper-based Ensemble Feature Selection</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
  <div id="quarto-announcement" data-announcement-id="2a29a73f7e8b4063ece399653c838ff3" class="alert alert-primary hidden"><i class="bi bi-info-circle quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p>The website features runtime <a href="benchmarks/benchmarks_paradox.qmd">benchmarks</a> of the paradox package now.</p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Wrapper-based Ensemble Feature Selection</h1>
                  <div>
        <div class="description">
          <p>Find the most stable and predictive features using multiple learners and resampling techniques.</p>
        </div>
      </div>
                </div>
  </div>

  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://github.com/bblodfon">John Zobolas</a> <a href="https://orcid.org/0000-0002-3609-8674" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 12, 2025</p>
      </div>
    </div>
    
      
    </div>
    

  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro">Intro</a></li>
  <li><a href="#libraries" id="toc-libraries" class="nav-link" data-scroll-target="#libraries">Libraries</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#efs-workflow" id="toc-efs-workflow" class="nav-link" data-scroll-target="#efs-workflow">EFS Workflow</a>
  <ul class="collapse">
  <li><a href="#parallelization" id="toc-parallelization" class="nav-link" data-scroll-target="#parallelization">Parallelization</a></li>
  <li><a href="#rfe" id="toc-rfe" class="nav-link" data-scroll-target="#rfe">RFE</a></li>
  <li><a href="#learners" id="toc-learners" class="nav-link" data-scroll-target="#learners">Learners</a></li>
  <li><a href="#callbacks" id="toc-callbacks" class="nav-link" data-scroll-target="#callbacks">Callbacks</a></li>
  </ul></li>
  <li><a href="#execute-efs" id="toc-execute-efs" class="nav-link" data-scroll-target="#execute-efs">Execute EFS</a></li>
  <li><a href="#analyze-efs-results" id="toc-analyze-efs-results" class="nav-link" data-scroll-target="#analyze-efs-results">Analyze EFS Results</a>
  <ul class="collapse">
  <li><a href="#result-object" id="toc-result-object" class="nav-link" data-scroll-target="#result-object">Result Object</a></li>
  <li><a href="#performance" id="toc-performance" class="nav-link" data-scroll-target="#performance">Performance</a></li>
  <li><a href="#number-of-selected-features" id="toc-number-of-selected-features" class="nav-link" data-scroll-target="#number-of-selected-features">Number of Selected Features</a></li>
  <li><a href="#pareto-plot" id="toc-pareto-plot" class="nav-link" data-scroll-target="#pareto-plot">Pareto Plot</a></li>
  <li><a href="#knee-point-identification" id="toc-knee-point-identification" class="nav-link" data-scroll-target="#knee-point-identification">Knee Point Identification</a></li>
  <li><a href="#stability" id="toc-stability" class="nav-link" data-scroll-target="#stability">Stability</a></li>
  <li><a href="#feature-ranking" id="toc-feature-ranking" class="nav-link" data-scroll-target="#feature-ranking">Feature Ranking</a></li>
  </ul></li>
  <li><a href="#efs-based-feature-selection" id="toc-efs-based-feature-selection" class="nav-link" data-scroll-target="#efs-based-feature-selection">EFS-based Feature Selection</a></li>
  <li><a href="#session-information" id="toc-session-information" class="nav-link" data-scroll-target="#session-information">Session Information</a>
  <ul class="collapse">
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="intro" class="level2">
<h2 class="anchored" data-anchor-id="intro">Intro</h2>
<p>In this post we will show how we can use the <code>mlr3fselect</code> R package to perform <em>wrapped</em>-based ensemble feature selection on a given dataset. Wrapper-based ensemble feature selection involves applying stability selection techniques (resampling of the data) to create robust feature subsets by leveraging multiple ML models in wrapper-based feature selection strategies.</p>
<p>Some papers from which we draw the ideas for this tutorial:</p>
<ul>
<li><strong>Stability selection</strong>, i.e.&nbsp;drawing multiple subsamples from a dataset and performing feature selection on each <span class="citation" data-cites="Meinshausen2010">(<a href="#ref-Meinshausen2010" role="doc-biblioref">Meinshausen and Bühlmann 2010</a>)</span>. Stability selection helps ensure that the selected features are robust to variations in the training data, increasing the reliability of the feature selection process.</li>
<li>The <strong>ensemble idea</strong> for feature selection, i.e.&nbsp;using multiple methods or models to perform feature selection on a dataset <span class="citation" data-cites="Saeys2008">(<a href="#ref-Saeys2008" role="doc-biblioref">Saeys, Abeel, and Van De Peer 2008</a>)</span>. This combines the strengths of different approaches to achieve more comprehensive results and alleviates biases that may arise from each individual approach for feature selection.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We also support <em>embedded-based</em> ensemble feature selection, see the function <a href="https://mlr3fselect.mlr-org.com/reference/embedded_ensemble_fselect.html"><code>mlr3fselect::embedded_ensemble_fselect()</code></a> for more details.</p>
</div>
</div>
</section>
<section id="libraries" class="level2">
<h2 class="anchored" data-anchor-id="libraries">Libraries</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3verse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fastVoteR) <span class="co"># for feature ranking</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(future)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(progressr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="dataset" class="level2">
<h2 class="anchored" data-anchor-id="dataset">Dataset</h2>
<p>We will use the <code>sonar</code> dataset, which is a binary classification task:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>task <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"sonar"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>task</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:sonar&gt; (208 x 61): Sonar: Mines vs. Rocks
* Target: Class
* Properties: twoclass
* Features (60):
  - dbl (60): V1, V10, V11, V12, V13, V14, V15, V16, V17, V18, V19, V2, V20, V21, V22, V23, V24, V25, V26,
    V27, V28, V29, V3, V30, V31, V32, V33, V34, V35, V36, V37, V38, V39, V4, V40, V41, V42, V43, V44, V45,
    V46, V47, V48, V49, V5, V50, V51, V52, V53, V54, V55, V56, V57, V58, V59, V6, V60, V7, V8, V9</code></pre>
</div>
</div>
</section>
<section id="efs-workflow" class="level2">
<h2 class="anchored" data-anchor-id="efs-workflow">EFS Workflow</h2>
<p>The <strong>ensemble feature selection (EFS)</strong> workflow is the following (in parentheses we provide the arguments for the <a href="https://mlr3fselect.mlr-org.com/reference/ensemble_fselect.html"><code>mlr3fselect::ensemble_fselect()</code></a> function that implements this process):</p>
<ol type="1">
<li>Repeatedly split a dataset to <strong>train/test sets</strong> (<code>init_resampling</code>), e.g.&nbsp;by subsampling <span class="math inline">\(B\)</span> times.</li>
<li>Choose <span class="math inline">\(M\)</span> <strong>learners</strong> (<code>learners</code>).<br>
</li>
<li>Perform <strong>wrapped-based feature selection</strong> on each train set from (1) using each of the models from (2). This process results in a ‘best’ feature (sub)set and a final trained model using these best features, for each combination of train set and learner (<span class="math inline">\(B \times M\)</span> combinations in total).</li>
<li>Score the final models on the respective test sets.</li>
</ol>
<p>To guide the feature selection process (3) we need to choose:</p>
<ul>
<li>An optimization algorithm (<code>fselector</code>), e.g.&nbsp;Recursive Feature Elimination (RFE)</li>
<li>An inner resampling technique (<code>inner_resampling</code>), e.g.&nbsp;5-fold cross-validation (CV)</li>
<li>An inner measure (<code>inner_measure</code>), e.g.&nbsp;classification error</li>
<li>A stopping criterion for the feature selection (<code>terminator</code>), i.e.&nbsp;how many iterations should the optimization algorithm run</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>inner_measure</code> (used for finding the best feature subset in each train set) and <code>measure</code> (assesses performance on each test set) can be different.</p>
</div>
</div>
<section id="parallelization" class="level3">
<h3 class="anchored" data-anchor-id="parallelization">Parallelization</h3>
<p>Internally, <code>ensemble_fselect()</code> performs a full <code>mlr3::benchmark()</code>, the results of which can be stored with the argument <code>store_benchmark_result</code>. The process is fully parallelizable, where <strong>every job is a (init resampling iteration, learner) combination</strong>. So it’s better to make sure that each RFE optimization (done via <a href="https://mlr3fselect.mlr-org.com/reference/auto_fselector.html">mlr3fselect::auto_fselector</a>) is single-threaded.</p>
<p>Below we show the code that setups the configuration for the parallelization:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parallelization for EFS: use 10 cores</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(<span class="st">"multisession"</span>, <span class="at">workers =</span> <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="rfe" class="level3">
<h3 class="anchored" data-anchor-id="rfe">RFE</h3>
<p>For each (train set, learner) combination we will run a Recursive Feature Elimination (RFE) optimization algorithm. We configure the algorithm to start with all features of the <code>task</code>, remove the 80% less important features in each iteration, and stop when 2 features are reached. In each RFE iteration, a 5-fold CV resampling of the given <code>task</code> takes place and a <code>learner</code> is trained and used for prediction on the test folds. The outcome of each RFE iteration is the average CV error (performance estimate) and the feature importances (by default the average of the feature ranks from each fold). Practically, for the <code>sonar</code> dataset, we will have <strong>15 RFE iterations</strong>, with the following feature subset sizes:</p>
<p><code>60 48 38 30 24 19 15 12 10 8  6  5  4  3  2</code></p>
<p>The best feature set will be chosen as the one with the <strong>lowest 5-fold CV error</strong>. i.e.&nbsp;the best performance estimate in the inner resampling.</p>
<p>In <code>mlr3</code> code, we specify the RFE <code>fselector</code> as:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>rfe <span class="ot">=</span> <span class="fu">fs</span>(<span class="st">"rfe"</span>, <span class="at">n_features =</span> <span class="dv">2</span>, <span class="at">feature_fraction =</span> <span class="fl">0.8</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>See <a href="https://mlr-org.com/gallery/optimization/2023-02-07-recursive-feature-elimination/">this gallery post</a> for more details on RFE optimization.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Using RFE as the feature selection optimization algorithm means that all <code>learners</code> need to have the <code>"importance"</code> property.</li>
</ul>
</div>
</div>
</section>
<section id="learners" class="level3">
<h3 class="anchored" data-anchor-id="learners">Learners</h3>
<p>We define a <code>list()</code> with the following classification <code>learners</code> (parameters are set at default values):</p>
<ol type="1">
<li>XGBoost with early stopping</li>
<li>A tree</li>
<li>A random forest (RF)</li>
<li>A Support Vector Machine (SVM)</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>max_nrounds <span class="ot">=</span> <span class="dv">500</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>learners <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lrn</span>(<span class="st">"classif.xgboost"</span>, <span class="at">id =</span> <span class="st">"xgb"</span>, <span class="at">nrounds =</span> max_nrounds,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">early_stopping_rounds =</span> <span class="dv">20</span>, <span class="at">validate =</span> <span class="st">"test"</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">id =</span> <span class="st">"tree"</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="at">id =</span> <span class="st">"rf"</span>, <span class="at">importance =</span> <span class="st">"permutation"</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lrn</span>(<span class="st">"classif.svm"</span>, <span class="at">id =</span> <span class="st">"svm"</span>, <span class="at">type =</span> <span class="st">"C-classification"</span>, <span class="at">kernel =</span> <span class="st">"linear"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is possible to perform tuning while also performing wrapper-based feature selection. This practically means that we would use an <code>AutoTuner</code> learner with its own inner resampling scheme and tuning space in the above list. The whole process would then be a double (nested) cross-validation with outer loop the <span class="math inline">\(B\)</span> subsample iterations, which is computationally taxing. Models that need minimum to no tuning (e.g.&nbsp;like Random Forests) are therefore ideal candidates for wrapper-based ensemble feature selection.</p>
</div>
</div>
</section>
<section id="callbacks" class="level3">
<h3 class="anchored" data-anchor-id="callbacks">Callbacks</h3>
<p>Since SVM doesn’t support <code>importance</code> scores by itself, we convert the coefficients of the trained linear SVM model to importance scores via a callback:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>svm_rfe <span class="ot">=</span> <span class="fu">clbk</span>(<span class="st">"mlr3fselect.svm_rfe"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>svm_rfe</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;CallbackBatchFSelect:mlr3fselect.svm_rfe&gt;: SVM-RFE Callback
* Active Stages: on_optimization_begin</code></pre>
</div>
</div>
<hr>
<p>Also, since the XGBoost learner performs <strong>internal tuning via early stopping</strong>, where the test folds in the inner cross-validation resampling scheme act as validation sets, we need to define the following callback:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>internal_ss <span class="ot">=</span> <span class="fu">ps</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="fu">p_int</span>(<span class="at">upper =</span> max_nrounds, <span class="at">aggr =</span> <span class="cf">function</span>(x) <span class="fu">as.integer</span>(<span class="fu">mean</span>(<span class="fu">unlist</span>(x))))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>xgb_clbk <span class="ot">=</span> <span class="fu">clbk</span>(<span class="st">"mlr3fselect.internal_tuning"</span>, <span class="at">internal_search_space =</span> internal_ss)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>xgb_clbk</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;CallbackBatchFSelect:mlr3fselect.internal_tuning&gt;: Internal Tuning
* Active Stages: on_auto_fselector_after_final_model, on_auto_fselector_before_final_model,
  on_eval_before_archive, on_optimization_end</code></pre>
</div>
</div>
<p>This practically sets the boosting rounds of the final XGBoost model (after the RFE optimization is finished) as the average boosting rounds from each subsequent training fold (corresponding to the model trained with the ‘best’ feature subset). For example, since we’re performing a 5-fold inner CV, we would have 5 different early-stopped boosting <code>nrounds</code>, from which we will use the average value to train the final XGBoost model using the whole train set.</p>
<hr>
<p>For all learners we will prefer <strong>sparser models during the RFE optimization process</strong>. This means that across all RFE iterations, we will choose as ‘best’ feature subset the one that has the minimum number of features and its performance is <strong>within one standard error</strong> of the feature set with the best performance (e.g.&nbsp;the lowest classification error). This can be achieved with the following callback:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>one_se_clbk <span class="ot">=</span> <span class="fu">clbk</span>(<span class="st">"mlr3fselect.one_se_rule"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>one_se_clbk</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;CallbackBatchFSelect:mlr3fselect.one_se_rule&gt;: One Standard Error Rule Callback
* Active Stages: on_optimization_end</code></pre>
</div>
</div>
</section>
</section>
<section id="execute-efs" class="level2">
<h2 class="anchored" data-anchor-id="execute-efs">Execute EFS</h2>
<p>Using the <a href="https://mlr3fselect.mlr-org.com/reference/ensemble_fselect.html"><code>mlr3fselect::ensemble_fselect()</code></a> function, we split the <code>sonar</code> task to <span class="math inline">\(B = 50\)</span> subsamples (each corresponding to a 80%/20% train/test set split) and perform RFE in each train set using each of the <span class="math inline">\(M = 4\)</span> learners.</p>
<p>For a particular (train set, learner) combination, the RFE process will evaluate the <span class="math inline">\(15\)</span> feature subsets mentioned above. Using the inner 5-fold CV resampling scheme, the average CV classification error will be used to find the best feature subset. Using only features from this best feature set, a final model will be trained using all the observations from each trained set. Lastly, the performance of this final model will be assessed on the corresponding test set using the classification accuracy metric.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>efs <span class="ot">=</span> <span class="fu">ensemble_fselect</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fselector =</span> rfe,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">task =</span> task,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">learners =</span> learners,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">init_resampling =</span> <span class="fu">rsmp</span>(<span class="st">"subsampling"</span>, <span class="at">repeats =</span> <span class="dv">50</span>, <span class="at">ratio =</span> <span class="fl">0.8</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner_resampling =</span> <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds =</span> <span class="dv">5</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">inner_measure =</span> <span class="fu">msr</span>(<span class="st">"classif.ce"</span>),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">measure =</span> <span class="fu">msr</span>(<span class="st">"classif.acc"</span>),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">"none"</span>),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># following list must be named with the learners' ids</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">callbacks =</span> <span class="fu">list</span>(</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">xgb  =</span> <span class="fu">list</span>(one_se_clbk, xgb_clbk),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">tree =</span> <span class="fu">list</span>(one_se_clbk),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">rf   =</span> <span class="fu">list</span>(one_se_clbk),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">svm  =</span> <span class="fu">list</span>(one_se_clbk, svm_rfe)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">store_benchmark_result =</span> <span class="cn">FALSE</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The result is stored in an <a href="https://mlr3fselect.mlr-org.com/reference/ensemble_fs_result.html"><code>EnsembleFSResult</code></a> object, which can use to visualize the results, rank the features and assess the stability of the ensemble feature selection process, among others.</p>
</section>
<section id="analyze-efs-results" class="level1">
<h1>Analyze EFS Results</h1>
<section id="result-object" class="level2">
<h2 class="anchored" data-anchor-id="result-object">Result Object</h2>
<p>Printing the result object provides some initial information:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(efs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;EnsembleFSResult&gt; with 4 learners and 50 initial resamplings
     resampling_iteration    learner_id n_features
                    &lt;int&gt;        &lt;char&gt;      &lt;int&gt;
  1:                    1 xgb.fselector          8
  2:                    2 xgb.fselector         30
  3:                    3 xgb.fselector         60
  4:                    4 xgb.fselector         19
  5:                    5 xgb.fselector          6
 ---                                              
196:                   46 svm.fselector         24
197:                   47 svm.fselector         19
198:                   48 svm.fselector         15
199:                   49 svm.fselector         19
200:                   50 svm.fselector          8</code></pre>
</div>
</div>
<p>As we can see, we have <span class="math inline">\(M \times B = 4 \times 50 = 200\)</span> (init resampling, learner) combinations. We can inspect the actual <code>data.table</code> result:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>efs<span class="sc">$</span>result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>        learner_id resampling_iteration classif.acc                    features n_features classif.ce_inner
            &lt;char&gt;                &lt;int&gt;       &lt;num&gt;                      &lt;list&gt;      &lt;int&gt;            &lt;num&gt;
  1: xgb.fselector                    1   0.6904762  V11,V12,V16,V21,V36,V4,...          8        0.1081996
  2: xgb.fselector                    2   0.9285714  V1,V10,V11,V12,V13,V15,...         30        0.1627451
  3: xgb.fselector                    3   0.8333333  V1,V10,V11,V12,V13,V14,...         60        0.1203209
  4: xgb.fselector                    4   0.8571429 V11,V12,V15,V16,V21,V27,...         19        0.1447415
  5: xgb.fselector                    5   0.7142857     V10,V11,V16,V31,V36,V45          6        0.1319073
 ---                                                                                                       
196: svm.fselector                   46   0.7619048  V1,V11,V12,V14,V23,V25,...         24        0.1440285
197: svm.fselector                   47   0.7380952 V11,V15,V23,V30,V31,V33,...         19        0.1331551
198: svm.fselector                   48   0.7619048 V12,V17,V31,V32,V36,V37,...         15        0.1809269
199: svm.fselector                   49   0.7142857 V11,V12,V14,V17,V20,V24,...         19        0.1864528
200: svm.fselector                   50   0.7619048 V11,V14,V23,V36,V39,V40,...          8        0.1629234
                            importance
                                &lt;list&gt;
  1:       6.8,6.8,6.4,3.8,3.6,3.4,...
  2: 27.2,26.8,25.6,22.0,22.0,21.6,...
  3: 60.0,57.6,53.8,52.0,51.4,49.6,...
  4: 19.0,13.4,13.0,12.8,12.2,11.0,...
  5:           4.4,4.2,4.2,3.8,2.2,2.2
 ---                                  
196: 24.0,21.6,20.2,18.4,17.6,16.8,...
197: 16.6,16.2,16.2,15.0,14.8,14.4,...
198: 14.0,13.6,13.0,10.4, 9.8, 9.2,...
199: 17.6,16.0,15.6,14.4,13.4,12.8,...
200:       8.0,5.8,5.6,5.2,4.6,3.2,...</code></pre>
</div>
</div>
<p>For each learner (<code>"learner_id"</code>) and dataset subsample (<code>"resampling_iteration"</code>) we get:</p>
<ul>
<li>The ‘best’ feature subsets (<code>"features"</code>)</li>
<li>The number of ‘best’ features (<code>"nfeatures"</code>)</li>
<li>The importances for these ‘best’ features (<code>"importance"</code>) - this output column we get only because RFE optimization was used</li>
<li>The inner optimization performance scores on the train sets (<code>"classif.ce_inner"</code>)</li>
<li>The performance scores on the test sets (<code>"classif.acc"</code>)</li>
</ul>
<p>Since there are two ways in this process to evaluate performance, we can always check which is the <strong>active measure</strong>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>efs<span class="sc">$</span>active_measure</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "outer"</code></pre>
</div>
</div>
<p>By default the active measure is the <code>"outer"</code>, i.e.&nbsp;the measure used to evaluate each learner’s performance in the test sets. In our case that was the classification accuracy:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>efs<span class="sc">$</span>measure</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;MeasureClassifSimple:classif.acc&gt;: Classification Accuracy
* Packages: mlr3, mlr3measures
* Range: [0, 1]
* Minimize: FALSE
* Average: macro
* Parameters: list()
* Properties: -
* Predict type: response</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the following sections we can use the inner optimization scores (i.e.&nbsp;<code>"classif.ce_inner"</code>) by executing <code>efs$set_active_measure("inner")</code>. This affects all methods and plots that use performance scores.</p>
</div>
</div>
</section>
<section id="performance" class="level2">
<h2 class="anchored" data-anchor-id="performance">Performance</h2>
<p>We can view the <strong>performance scores of the different learners</strong> used in the ensemble feature selection process. Each box represents the distribution of scores across different resampling iterations for a particular learner.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(efs, <span class="at">type =</span> <span class="st">"performance"</span>, <span class="at">theme =</span> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/efs-015-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We observe that RF has better classification accuracy on the test sets of the <span class="math inline">\(50\)</span> subsamples, followed by XGBoost, then the SVM and last the tree model.</p>
</section>
<section id="number-of-selected-features" class="level2">
<h2 class="anchored" data-anchor-id="number-of-selected-features">Number of Selected Features</h2>
<p>Continuing, we can plot <strong>the number of features selected by each learner</strong> in the different resampling iterations:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(efs, <span class="at">type =</span> <span class="st">"n_features"</span>, <span class="at">theme =</span> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">60</span>, <span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/efs-016-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We observe that RF needed more features to achieve the best average performance, followed by SVM, then XGBoost and the tree model was the model using the least features (but with worst performance).</p>
</section>
<section id="pareto-plot" class="level2">
<h2 class="anchored" data-anchor-id="pareto-plot">Pareto Plot</h2>
<p>Both performance scores and number of features selected by the RFE optimization process can be visualized jointly in the Pareto plot. Here we also draw the <strong>Pareto front</strong>, i.e.&nbsp;the set of points that represent the trade-off between the number of features and performance (classification accuracy). As we see below, these points are derived from multiple learners and resamplings:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(efs, <span class="at">type =</span> <span class="st">"pareto"</span>, <span class="at">theme =</span> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Empirical Pareto front"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/efs-017-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also draw an <strong>estimated Pareto front curve</strong> by fitting a linear model with the inverse of the number of selected features (<span class="math inline">\(1/x\)</span>) of the empirical Pareto front as input, and the associated performance scores as output:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(efs, <span class="at">type =</span> <span class="st">"pareto"</span>, <span class="at">pareto_front =</span> <span class="st">"estimated"</span>, </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">theme =</span> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Estimated Pareto front"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/efs-018-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="knee-point-identification" class="level2">
<h2 class="anchored" data-anchor-id="knee-point-identification">Knee Point Identification</h2>
<p>No matter the type of Pareto front that we chose, specialized methods are available to identify <strong>knee points</strong>, i.e.&nbsp;points of the Pareto front with an <strong>optimal trade-off between performance and number of selected features</strong>.</p>
<p>By default, we use the geometry-based <em>Normal-Boundary Intersection</em> (NBI) method. This approach calculates the perpendicular distance of each point from the line connecting the first (worst performance, minimum number of features) and last (best performance, maximum number of features) point of the Pareto front. The knee point is then identified as the point with the maximum distance from this line <span class="citation" data-cites="Das1999">(<a href="#ref-Das1999" role="doc-biblioref">Das 1999</a>)</span>.</p>
<p>Using the empirical and estimated Pareto fronts, we observe that the optimal knee points correspond to different numbers of features:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>efs<span class="sc">$</span><span class="fu">knee_points</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   n_features classif.acc
        &lt;num&gt;       &lt;num&gt;
1:         10   0.9047619</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>efs<span class="sc">$</span><span class="fu">knee_points</span>(<span class="at">type =</span> <span class="st">"estimated"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   n_features classif.acc
        &lt;int&gt;       &lt;num&gt;
1:          8   0.8597253</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Number of features cutoff">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Number of features cutoff
</div>
</div>
<div class="callout-body-container callout-body">
<p>The number of features at the identified knee point provides a cutoff for prioritizing features when working with a ranked feature list (see “Feature Ranking” section).</p>
</div>
</div>
</section>
<section id="stability" class="level2">
<h2 class="anchored" data-anchor-id="stability">Stability</h2>
<p>The <code>stabm</code> R package <span class="citation" data-cites="Bommert2021">(<a href="#ref-Bommert2021" role="doc-biblioref">Bommert and Lang 2021</a>)</span> implements many measures for the assessment of the <strong>stability of feature selection</strong>, i.e.&nbsp;the similarity between the selected feature sets (<code>"features"</code> column in the <code>EnsembleFSResult</code> object). We can use these measures to assess and visualize the stability across all resampling iterations and learners (<code>global = "TRUE"</code>) or per each learner separately (<code>global = "FALSE"</code>).</p>
<p>The default stability measure is the <strong>Jaccard Index</strong>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>efs<span class="sc">$</span><span class="fu">stability</span>(<span class="at">stability_measure =</span> <span class="st">"jaccard"</span>, <span class="at">global =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2640504</code></pre>
</div>
</div>
<p>Stability per learner:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>efs<span class="sc">$</span><span class="fu">stability</span>(<span class="at">stability_measure =</span> <span class="st">"jaccard"</span>, <span class="at">global =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> xgb.fselector tree.fselector   rf.fselector  svm.fselector 
     0.3657964      0.3554681      0.4716744      0.3119381 </code></pre>
</div>
</div>
<p>We observe that the RF model was the most stable in identifying similar predictive features across the different subsamples of the dataset, while the SVM model the least stable.</p>
<p>To visualize stability, the following code generates a stability barplot:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(efs, <span class="at">type =</span> <span class="st">"stability"</span>, <span class="at">theme =</span> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/efs-022-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Alternatively, the <strong>Nogueira</strong> stability measure can be used, which unlike the Jaccard Index, it’s a chance-corrected similarity measure <span class="citation" data-cites="Nogueira2018">(<a href="#ref-Nogueira2018" role="doc-biblioref">Nogueira, Sechidis, and Brown 2018</a>)</span>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(efs, <span class="at">type =</span> <span class="st">"stability"</span>, <span class="at">stability_measure =</span> <span class="st">"nogueira"</span>, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">stability_args =</span> <span class="fu">list</span>(<span class="at">p =</span> task<span class="sc">$</span>n_features), </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">theme =</span> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/efs-023-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="feature-ranking" class="level2">
<h2 class="anchored" data-anchor-id="feature-ranking">Feature Ranking</h2>
<p>Using the Pareto method, we demonstrated how we can identify a reasonable cutoff for the number of selected features. Now we will focus on how to create a consensus ranked feature list based on the results of the ensemble feature selection.</p>
<p>The most straightforward ranking is obtained by counting how often each feature appears in the ‘best’ feature subsets (<code>"features"</code>). Below we show the top 8 features, i.e.&nbsp;up to the cutoff derived from the knee point of the estimated Pareto front. The column <code>"score"</code> represents these counts, while the column <code>"norm_score"</code> is the <strong>feature selection frequency</strong> or also known as <strong>selection probability</strong> <span class="citation" data-cites="Meinshausen2010">(<a href="#ref-Meinshausen2010" role="doc-biblioref">Meinshausen and Bühlmann 2010</a>)</span>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>efs<span class="sc">$</span><span class="fu">feature_ranking</span>(<span class="at">method =</span> <span class="st">"av"</span>, <span class="at">use_weights =</span> <span class="cn">FALSE</span>, <span class="at">committee_size =</span> <span class="dv">8</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   feature score norm_score borda_score
    &lt;char&gt; &lt;num&gt;      &lt;num&gt;       &lt;num&gt;
1:     V12   179      0.895   1.0000000
2:     V11   170      0.850   0.9830508
3:      V9   123      0.615   0.9661017
4:     V45   121      0.605   0.9491525
5:     V16   118      0.590   0.9322034
6:     V36   113      0.565   0.9152542
7:     V49   104      0.520   0.8983051
8:      V4    99      0.495   0.8813559</code></pre>
</div>
</div>
<p>In the language of Voting Theory, we call the method that generates these counts <em>approval voting</em> (<code>method = "av"</code>) <span class="citation" data-cites="Lackner2023">(<a href="#ref-Lackner2023" role="doc-biblioref">Lackner and Skowron 2023</a>)</span>. Using this framework, learners act as <em>voters</em>, features act as <em>candidates</em> and voters select certain candidates (features). The primary objective is to compile these selections into a consensus ranked list of features (a committee). The <code>committee_size</code> specifies how many (top-ranked) features to return.</p>
<p>Internally, <code>$feature_ranking()</code> uses the <a href="https://bblodfon.github.io/fastVoteR/"><code>fastVoteR</code></a> R package, which supports more advanced ranking methods. For example, we can perform <strong>weighted ranking</strong>, by considering the varying performance (accuracy) of each learner. This results in the same top 8 features but with slightly different ordering:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>efs<span class="sc">$</span><span class="fu">feature_ranking</span>(<span class="at">method =</span> <span class="st">"av"</span>, <span class="at">use_weights =</span> <span class="cn">TRUE</span>, <span class="at">committee_size =</span> <span class="dv">8</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   feature     score norm_score borda_score
    &lt;char&gt;     &lt;num&gt;      &lt;num&gt;       &lt;num&gt;
1:     V12 134.78571  0.8995710   1.0000000
2:     V11 127.33333  0.8498331   0.9830508
3:     V45  94.45238  0.6303830   0.9661017
4:      V9  93.71429  0.6254569   0.9491525
5:     V16  89.76190  0.5990783   0.9322034
6:     V36  87.97619  0.5871603   0.9152542
7:     V49  80.64286  0.5382171   0.8983051
8:      V4  76.64286  0.5115207   0.8813559</code></pre>
</div>
</div>
<p>Additionally, alternative ranking methods are supported. Below, we use <em>satisfaction approval voting</em> (SAV), which ranks features by normalizing approval scores based on the number of features a model has selected. Specifically, models that select more features distribute their “approval” across a larger set, reducing the contribution to each selected feature. Conversely, <strong>features chosen by models with fewer selected features receive higher weights</strong>, as their selection reflects stronger individual importance. This approach ensures that sparsely selected features are prioritized in the ranking, leading to a different set of top-ranked features compared to standard approval voting. For instance, in the example above, the <code>"V10"</code> feature enters the top 8 features, replacing <code>"V4"</code>:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>efs<span class="sc">$</span><span class="fu">feature_ranking</span>(<span class="at">method =</span> <span class="st">"sav"</span>, <span class="at">committee_size =</span> <span class="dv">8</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   feature     score norm_score borda_score
    &lt;char&gt;     &lt;num&gt;      &lt;num&gt;       &lt;num&gt;
1:     V11 15.353545  0.9100050   1.0000000
2:     V12 14.107691  0.8361632   0.9830508
3:     V16  7.698460  0.4562879   0.9661017
4:     V45  6.811607  0.4037241   0.9491525
5:      V9  6.443311  0.3818952   0.9322034
6:     V36  6.060615  0.3592128   0.9152542
7:     V10  5.955446  0.3529794   0.8983051
8:     V49  4.741014  0.2810000   0.8813559</code></pre>
</div>
</div>
</section>
</section>
<section id="efs-based-feature-selection" class="level1">
<h1>EFS-based Feature Selection</h1>
<p>The ultimate goal of the ensemble feature selection process is to identify predictive and stable features. By combining the ranked feature list with the Pareto-derived cutoff, we can select the final set of features for further modeling:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>n_features <span class="ot">=</span> efs<span class="sc">$</span><span class="fu">knee_points</span>(<span class="at">type =</span> <span class="st">"estimated"</span>)<span class="sc">$</span>n_features</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> efs<span class="sc">$</span><span class="fu">feature_ranking</span>(<span class="at">method =</span> <span class="st">"sav"</span>, <span class="at">committee_size =</span> n_features)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>feature</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "V11" "V12" "V16" "V45" "V9"  "V36" "V10" "V49"</code></pre>
</div>
</div>
</section>
<section id="session-information" class="level1">
<h1>Session Information</h1>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>(<span class="at">info =</span> <span class="st">"packages"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>═ Session info ═══════════════════════════════════════════════════════════════════════════════════════════════════════
─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────
 ! package          * version     date (UTC) lib source
 P backports          1.5.0       2024-05-23 [?] CRAN (R 4.4.2)
 P bbotk              1.5.0       2024-12-17 [?] CRAN (R 4.4.2)
 P checkmate          2.3.2       2024-07-29 [?] CRAN (R 4.4.2)
 P class              7.3-22      2023-05-03 [?] CRAN (R 4.4.2)
 P cli                3.6.3       2024-06-21 [?] CRAN (R 4.4.2)
 P clue               0.3-66      2024-11-13 [?] CRAN (R 4.4.2)
 P cluster            2.1.6       2023-12-01 [?] CRAN (R 4.4.2)
 P codetools          0.2-20      2024-03-31 [?] CRAN (R 4.4.2)
 P colorspace         2.1-1       2024-07-26 [?] CRAN (R 4.4.2)
 P crayon             1.5.3       2024-06-20 [?] CRAN (R 4.4.2)
 P data.table       * 1.16.4      2024-12-06 [?] CRAN (R 4.4.2)
 P DEoptimR           1.1-3-1     2024-11-23 [?] CRAN (R 4.4.2)
 P digest             0.6.37      2024-08-19 [?] CRAN (R 4.4.2)
 P diptest            0.77-1      2024-04-10 [?] CRAN (R 4.4.2)
 P evaluate           1.0.1       2024-10-10 [?] CRAN (R 4.4.2)
 P farver             2.1.2       2024-05-13 [?] CRAN (R 4.4.2)
 P fastmap            1.2.0       2024-05-15 [?] CRAN (R 4.4.2)
 P fastVoteR        * 0.0.1       2024-11-27 [?] RSPM
 P flexmix            2.3-19      2023-03-16 [?] CRAN (R 4.4.2)
 P fpc                2.2-13      2024-09-24 [?] CRAN (R 4.4.2)
 P future           * 1.34.0      2024-07-29 [?] CRAN (R 4.4.2)
 P ggplot2          * 3.5.1       2024-04-23 [?] CRAN (R 4.4.2)
 P globals            0.16.3      2024-03-08 [?] CRAN (R 4.4.2)
 P glue               1.8.0       2024-09-30 [?] CRAN (R 4.4.2)
 P gtable             0.3.6       2024-10-25 [?] CRAN (R 4.4.2)
 P htmltools          0.5.8.1     2024-04-04 [?] CRAN (R 4.4.2)
 P jsonlite           1.8.9       2024-09-20 [?] CRAN (R 4.4.2)
 P kernlab            0.9-33      2024-08-13 [?] CRAN (R 4.4.2)
 P knitr              1.49        2024-11-08 [?] CRAN (R 4.4.2)
 P labeling           0.4.3       2023-08-29 [?] CRAN (R 4.4.2)
 P lattice            0.22-6      2024-03-20 [?] CRAN (R 4.4.2)
 P lgr                0.4.4       2022-09-05 [?] CRAN (R 4.4.2)
 P lifecycle          1.0.4       2023-11-07 [?] CRAN (R 4.4.2)
 P listenv            0.9.1       2024-01-29 [?] CRAN (R 4.4.2)
 P magrittr           2.0.3       2022-03-30 [?] CRAN (R 4.4.2)
 P MASS               7.3-61      2024-06-13 [?] CRAN (R 4.4.2)
 P Matrix             1.7-1       2024-10-18 [?] CRAN (R 4.4.2)
 P mclust             6.1.1       2024-04-29 [?] CRAN (R 4.4.2)
 P mlr3             * 0.22.1      2024-11-27 [?] CRAN (R 4.4.2)
 P mlr3cluster        0.1.10      2024-10-03 [?] CRAN (R 4.4.2)
 P mlr3data           0.9.0       2024-11-08 [?] CRAN (R 4.4.2)
 P mlr3filters        0.8.1       2024-11-08 [?] CRAN (R 4.4.2)
 P mlr3fselect        1.2.1.9000  2024-12-16 [?] Github (mlr-org/mlr3fselect@ab6360a)
 P mlr3hyperband      0.6.0       2024-06-29 [?] CRAN (R 4.4.2)
 P mlr3learners       0.9.0       2024-11-23 [?] CRAN (R 4.4.2)
 P mlr3mbo            0.2.8       2024-11-21 [?] CRAN (R 4.4.2)
 P mlr3measures       1.0.0       2024-09-11 [?] CRAN (R 4.4.2)
 P mlr3misc           0.16.0      2024-11-28 [?] CRAN (R 4.4.2)
 P mlr3pipelines      0.7.1       2024-11-14 [?] CRAN (R 4.4.2)
 P mlr3tuning         1.3.0       2024-12-17 [?] CRAN (R 4.4.2)
 P mlr3tuningspaces   0.5.2       2024-11-22 [?] CRAN (R 4.4.2)
 P mlr3verse        * 0.3.0       2024-06-30 [?] CRAN (R 4.4.2)
 P mlr3viz            0.10.0.9000 2024-12-30 [?] Github (mlr-org/mlr3viz@b96b886)
 P modeltools         0.2-23      2020-03-05 [?] CRAN (R 4.4.2)
 P munsell            0.5.1       2024-04-01 [?] CRAN (R 4.4.2)
 P nnet               7.3-19      2023-05-03 [?] CRAN (R 4.4.2)
 P palmerpenguins     0.1.1       2022-08-15 [?] CRAN (R 4.4.2)
 P paradox            1.0.1       2024-07-09 [?] CRAN (R 4.4.2)
 P parallelly         1.41.0      2024-12-18 [?] CRAN (R 4.4.2)
 P pillar             1.10.0      2024-12-17 [?] CRAN (R 4.4.2)
 P pkgconfig          2.0.3       2019-09-22 [?] CRAN (R 4.4.2)
 P prabclus           2.3-4       2024-09-24 [?] CRAN (R 4.4.2)
 P progressr        * 0.15.1      2024-11-22 [?] CRAN (R 4.4.2)
 P R6                 2.5.1       2021-08-19 [?] CRAN (R 4.4.2)
 P RColorBrewer       1.1-3       2022-04-03 [?] CRAN (R 4.4.2)
 P Rcpp               1.0.13-1    2024-11-02 [?] CRAN (R 4.4.2)
   renv               1.0.11      2024-10-12 [1] CRAN (R 4.4.2)
 P rlang              1.1.4       2024-06-04 [?] CRAN (R 4.4.2)
 P rmarkdown          2.29        2024-11-04 [?] CRAN (R 4.4.2)
 P robustbase         0.99-4-1    2024-09-27 [?] CRAN (R 4.4.2)
 P scales             1.3.0       2023-11-28 [?] CRAN (R 4.4.2)
 P sessioninfo        1.2.2       2021-12-06 [?] CRAN (R 4.4.2)
 P spacefillr         0.3.3       2024-05-22 [?] CRAN (R 4.4.2)
 P stabm              1.2.2       2023-04-04 [?] CRAN (R 4.4.2)
 P tibble             3.2.1       2023-03-20 [?] CRAN (R 4.4.2)
 P uuid               1.2-1       2024-07-29 [?] CRAN (R 4.4.2)
 P vctrs              0.6.5       2023-12-01 [?] CRAN (R 4.4.2)
 P withr              3.0.2       2024-10-28 [?] CRAN (R 4.4.2)
 P xfun               0.49        2024-10-31 [?] CRAN (R 4.4.2)
 P yaml               2.3.10      2024-07-26 [?] RSPM

 [1] /home/john/repos/mlr3-packages/mlr3website/mlr-org/renv/library/linux-ubuntu-focal/R-4.4/x86_64-pc-linux-gnu
 [2] /home/john/.cache/R/renv/sandbox/linux-ubuntu-focal/R-4.4/x86_64-pc-linux-gnu/db5e602d

 P ── Loaded and on-disk path mismatch.

──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<section id="references" class="level2">




</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Bommert2021" class="csl-entry" role="listitem">
Bommert, Andrea, and Michel Lang. 2021. <span>“<span class="nocase">stabm: Stability Measures for Feature Selection</span>.”</span> <em>Journal of Open Source Software</em> 6 (59): 3010. <a href="https://doi.org/10.21105/JOSS.03010">https://doi.org/10.21105/JOSS.03010</a>.
</div>
<div id="ref-Das1999" class="csl-entry" role="listitem">
Das, I. 1999. <span>“<span class="nocase">On characterizing the "knee" of the Pareto curve based on normal-boundary intersection</span>.”</span> <em>Structural Optimization</em> 18 (2-3): 107–15. <a href="https://doi.org/10.1007/BF01195985/METRICS">https://doi.org/10.1007/BF01195985/METRICS</a>.
</div>
<div id="ref-Lackner2023" class="csl-entry" role="listitem">
Lackner, Martin, and Piotr Skowron. 2023. <em><span class="nocase">Multi-Winner Voting with Approval Preferences</span></em>. Springer Nature. <a href="https://doi.org/10.1007/978-3-031-09016-5">https://doi.org/10.1007/978-3-031-09016-5</a>.
</div>
<div id="ref-Meinshausen2010" class="csl-entry" role="listitem">
Meinshausen, Nicolai, and Peter Bühlmann. 2010. <span>“<span>Stability Selection</span>.”</span> <em>Journal of the Royal Statistical Society Series B: Statistical Methodology</em> 72 (4): 417–73. <a href="https://doi.org/10.1111/J.1467-9868.2010.00740.X">https://doi.org/10.1111/J.1467-9868.2010.00740.X</a>.
</div>
<div id="ref-Nogueira2018" class="csl-entry" role="listitem">
Nogueira, Sarah, Konstantinos Sechidis, and Gavin Brown. 2018. <span>“<span class="nocase">On the Stability of Feature Selection Algorithms</span>.”</span> <em>Journal of Machine Learning Research</em> 18 (174): 1–54. <a href="http://jmlr.org/papers/v18/17-514.html">http://jmlr.org/papers/v18/17-514.html</a>.
</div>
<div id="ref-Saeys2008" class="csl-entry" role="listitem">
Saeys, Yvan, Thomas Abeel, and Yves Van De Peer. 2008. <span>“<span class="nocase">Robust feature selection using ensemble feature selection techniques</span>.”</span> <em>Machine Learning and Knowledge Discovery in Databases</em> 5212 LNAI: 313–25. <a href="https://doi.org/10.1007/978-3-540-87481-2_21">https://doi.org/10.1007/978-3-540-87481-2_21</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mlr-org\.com\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Created with <i class="bi bi-heart-fill"></i> for #rstats.</p>
</div>   
    <div class="nav-footer-center">
<p>CC BY SA 4.0</p>
</div>
    <div class="nav-footer-right">
<p>Website powered by <a href="https://quarto.org/">quarto</a> and <a href="https://www.netlify.com/">Netlify</a>.</p>
</div>
  </div>
</footer>




</body></html>