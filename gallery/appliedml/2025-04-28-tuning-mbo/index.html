<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Giuseppe Casalicchio">
<meta name="author" content="Essential Data Science Training GmbH">
<meta name="description" content="Use Bayesian optimization (BO) using bbotk and mlr3mbo for general black box optimization problems, and more specifically, hyperparameter optimization (HPO).">

<title>Deep dive into Bayesian Optimization – mlr-org</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-1fa5e93acb50773330e542bbd58c1e25.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 2,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 5,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">mlr-org</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-overview" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Overview</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-overview">    
        <li>
    <a class="dropdown-item" href="../../../ecosystem.html">
 <span class="dropdown-text">Ecosystem</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../dependencies.html">
 <span class="dropdown-text">Dependencies</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../../tasks.html">
 <span class="dropdown-text">Tasks</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../learners.html">
 <span class="dropdown-text">Learners</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../resamplings.html">
 <span class="dropdown-text">Resamplings</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../measures.html">
 <span class="dropdown-text">Measures</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../../pipeops.html">
 <span class="dropdown-text">Pipeline Operators</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../graphs.html">
 <span class="dropdown-text">Graphs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../torch_pipeops.html">
 <span class="dropdown-text">Torch Pipeline Operators</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../../tuners.html">
 <span class="dropdown-text">Tuners</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../tuning_spaces.html">
 <span class="dropdown-text">Tuning Spaces</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../terminators.html">
 <span class="dropdown-text">Terminators</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../../filters.html">
 <span class="dropdown-text">Feature Selection Filter</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../fselectors.html">
 <span class="dropdown-text">Feature Selection Wrapper</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../book.html"> 
<span class="menu-text">Book</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../gallery.html"> 
<span class="menu-text">Gallery</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-benchmarks" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Benchmarks</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-benchmarks">    
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_mlr3.html">
 <span class="dropdown-text">mlr3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_mlr3fselect.html">
 <span class="dropdown-text">mlr3fselect</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_mlr3tuning.html">
 <span class="dropdown-text">mlr3tuning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_async.html">
 <span class="dropdown-text">mlr3tuning async</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmark_rush.html">
 <span class="dropdown-text">rush</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_paradox.html">
 <span class="dropdown-text">paradox</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../team.html"> 
<span class="menu-text">Team</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-more" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">More</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-more">    
        <li>
    <a class="dropdown-item" href="../../../support.html">
 <span class="dropdown-text">Support</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contributing.html">
 <span class="dropdown-text">Contributing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../faq.html">
 <span class="dropdown-text">Frequently Asked Questions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../blogroll.html">
 <span class="dropdown-text">Blogroll</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-rss" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-rss">    
        <li>
    <a class="dropdown-item" href="../../../gallery-all.xml">
 <span class="dropdown-text">Gallery RSS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite"> <i class="bi bi-chat-dots" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://stackoverflow.com/questions/tagged/mlr3"> <i class="bi bi-stack-overflow" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mlr-org"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Deep dive into Bayesian Optimization</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
  <div id="quarto-announcement" data-announcement-id="2a29a73f7e8b4063ece399653c838ff3" class="alert alert-primary hidden"><i class="bi bi-info-circle quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p>The website features runtime <a href="benchmarks/benchmarks_paradox.qmd">benchmarks</a> of the paradox package now.</p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Deep dive into Bayesian Optimization</h1>
                  <div>
        <div class="description">
          <p>Use Bayesian optimization (BO) using <code>bbotk</code> and <code>mlr3mbo</code> for general black box optimization problems, and more specifically, hyperparameter optimization (HPO).</p>
        </div>
      </div>
                </div>
  </div>

  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Authors</div>
      <div class="quarto-title-meta-contents">
               <p>Giuseppe Casalicchio </p>
               <p><a href="https://www.essentialds.de">Essential Data Science Training GmbH</a> </p>
            </div>
    </div>
      
    
      
    </div>
    

  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#goal" id="toc-goal" class="nav-link active" data-scroll-target="#goal">Goal</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites">Prerequisites</a></li>
  <li><a href="#building-blocks-of-bo" id="toc-building-blocks-of-bo" class="nav-link" data-scroll-target="#building-blocks-of-bo">1 Building Blocks of BO</a>
  <ul class="collapse">
  <li><a href="#initial-design" id="toc-initial-design" class="nav-link" data-scroll-target="#initial-design">1.1 Initial design</a></li>
  <li><a href="#generate-data-from-initial-design" id="toc-generate-data-from-initial-design" class="nav-link" data-scroll-target="#generate-data-from-initial-design">1.2 Generate data from initial design</a></li>
  <li><a href="#train-surrogate-model" id="toc-train-surrogate-model" class="nav-link" data-scroll-target="#train-surrogate-model">1.3 Train surrogate model</a></li>
  <li><a href="#define-an-acquisition-function" id="toc-define-an-acquisition-function" class="nav-link" data-scroll-target="#define-an-acquisition-function">1.4 Define an acquisition function</a></li>
  <li><a href="#optimize-acquisition-function" id="toc-optimize-acquisition-function" class="nav-link" data-scroll-target="#optimize-acquisition-function">1.5 Optimize acquisition function</a></li>
  </ul></li>
  <li><a href="#automating-bo-with-optimizermbo" id="toc-automating-bo-with-optimizermbo" class="nav-link" data-scroll-target="#automating-bo-with-optimizermbo">2 Automating BO with <code>OptimizerMbo</code></a></li>
  <li><a href="#bo-for-hpo-with-tunermbo" id="toc-bo-for-hpo-with-tunermbo" class="nav-link" data-scroll-target="#bo-for-hpo-with-tunermbo">3 BO for HPO with <code>TunerMbo</code></a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<script>
const correctHash = "54b947c39cf237109b63d401e547398aef79e4bbd57b05a0bfe5f8064d0c1607";   // value injected by knitr

/* ---------- reusable helper ---------- */
function b64DecodeUtf8(b64) {
  // 1) atob  -> binary-string   (bytes 0…255)
  // 2) map   -> Uint8Array      (array of bytes)
  // 3) TextDecoder('utf-8')     -> real JS string
  const bytes = Uint8Array.from(atob(b64), c => c.charCodeAt(0));
  return new TextDecoder('utf-8').decode(bytes);
}

async function sha256(txt) {
  const buf = await crypto.subtle.digest('SHA-256',
                 new TextEncoder().encode(txt));
  return Array.from(new Uint8Array(buf))
              .map(b => b.toString(16).padStart(2, '0')).join('');
}

async function unlockOne(btn) {
  const pass = prompt("Password:");
  if (!pass) return;
  if (await sha256(pass) !== correctHash) {
    alert("Wrong password"); return;
  }

  /* --- decode only the solution that belongs to THIS button --- */
  const wrapper = btn.parentElement;             // .b64-wrapper
  wrapper.querySelectorAll('.hidden-solution').forEach(div => {
    div.innerHTML = b64DecodeUtf8(div.dataset.encoded);
    div.classList.remove('hidden-solution');
    div.style.display = 'block';
  });

  /* Remove the button so the user can’t click it again */
  btn.remove();
}
</script>

<noscript>
<div style="border: 1px solid #ccc; padding: 1em; margin-top: 1em; background: #f9f9f9;">
    <strong>JavaScript is required to unlock solutions.</strong><br>
    Please enable JavaScript and reload the page,<br>
    or download the source files from
    <a href="https://github.com/mlr-org/mlr3website/" target="_blank" rel="noopener noreferrer">GitHub</a>
    and run the code locally.
  </div>
</noscript>
<section id="goal" class="level1">
<h1>Goal</h1>
<p>After this exercise, you should be able to navigate the building blocks of Bayesian optimization (BO) using <code>bbotk</code> and <code>mlr3mbo</code> for general black box optimization problems, and more specifically, hyperparameter optimization (HPO).</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This section is a deep dive into Bayesian optimization (BO), also known as Model Based Optimization (MBO). BO is more complex than other tuning methods, so we will motivate theory and methodology first.</p>
<p><strong>Black Box Optimization</strong></p>
<p>In hyperparameter optimization, learners are passed a hyperparameter configuration and evaluated on a given task via a resampling technique to estimate its generalization performance with the goal to find the optimal hyperparameter configuration. In general, this is a black box optimization problem, which considers the optimization of a function whose mathematical structure is unknown or unexploitable. The only thing we can observe is the generalization performance of the function given a hyperparameter configuration. As evaluating the performance of a learner can take a lot of time, HPO is an expensive black box optimization problem.</p>
<p><strong>Bayesian Optimization</strong></p>
<p>There is many ways of doing black box optimization, grid and random search being examples for simple strategies. Bayesian optimization are a class of black box optimization algorithms that rely on a ‘surrogate model’ trained on observed hyperparameter evaluations to model the black box function. This surrogate model tries to capture the unknown function between hyperparameter configuations and estimated generalization performance using (the very low number of) observed function evaluations. During each iteration, BO algorithms employ an ‘acquisition function’ to determine the next candidate point for evaluation. This function measures the expected ‘utility’ of each point within the search space based on the prediction of the surrogate model. The algorithm then selects the candidate point with the best acquisition function value and evaluates the black box function at that point to then update the surrogate model. This iterative process continues until a termination criterion is met, such as reaching a pre-specified maximum number of evaluations or achieving a desired level of performance. BO is a powerful method that often results in good optimization performance, especially if the cost of the black box evaluation becomes expensive and the optimization budget is tight.</p>
<p>In the rest of this section, we will first provide an introduction to black box optimization with the bbotk package and then introduce the building blocks of BO algorithms and examine their interplay and interaction during the optimization process before we assemble these building blocks in a ready to use black box optimizer with <code>mlr3mbo</code>.</p>
</section>
<section id="prerequisites" class="level1">
<h1>Prerequisites</h1>
<p>Let’s load the packages required for this exercise:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbotk)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3verse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3mbo)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Before we apply BO to hyperparamter optimization (HPO), we try to optimize the following simple sinusoidal function:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sinus_1D <span class="ot">=</span> <span class="cf">function</span>(xs) <span class="dv">2</span> <span class="sc">*</span> xs<span class="sc">$</span>x1 <span class="sc">*</span> <span class="fu">sin</span>(<span class="dv">14</span> <span class="sc">*</span> xs<span class="sc">$</span>x1) <span class="sc">*</span> <span class="fu">sin</span>(xs<span class="sc">$</span>x2) <span class="sc">*</span> xs<span class="sc">$</span>x2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="building-blocks-of-bo" class="level1">
<h1>1 Building Blocks of BO</h1>
<p>Bayesian optimization (BO) usually follows this process:</p>
<ol type="1">
<li><p>Generate and evaluate an initial design</p></li>
<li><p>Loop:</p>
<ul>
<li>2.1. Fit a surrogate model on the archive of all observations made so far to model the unknown black box function.</li>
<li>2.2. Optimize an acquisition function to determine which points of the search space are promising candidate(s) that should be evaluated next.</li>
<li>2.3. Evaluate the next candidate(s) and update the archive of all observations made so far.</li>
<li>2.4. Check if a given termination criterion is met, if not go back to 2.1.</li>
</ul></li>
</ol>
<p>The acquisition function relies on the mean and standard deviation prediction of the surrogate model and requires no evaluation of the true black box function, making it comparably cheap to optimize. A good acquisition function will balance exploiting knowledge about regions where we observed that performance is good and the surrogate model has low uncertainty with exploring regions where it has not yet evaluated points and as a result the uncertainty of the surrogate model is high.</p>
<p>BO is a highly modular algorithm: as long as the above structure is in place, then the surrogate models, acquisition functions, and acquisition function optimizers are all interchangeable to a certain extent. The design of <code>mlr3mbo</code> reflects this modularity, with the base class for <code>OptimizerMbo</code> holding all the key elements: the BO algorithm loop structure (<code>loop_function</code>), surrogate model (<code>Surrogate</code>), acquisition function (<code>AcqFunction</code>), and acquisition function optimizer (<code>AcqOptimizer</code>). Let’s explore the interplay and interaction of these building blocks during optimization.</p>
<section id="initial-design" class="level2">
<h2 class="anchored" data-anchor-id="initial-design">1.1 Initial design</h2>
<p>The initial set of points that is evaluated before a surrogate model can be fit is referred to as the initial design. <code>mlr3mbo</code> allows you to either construct this manually or let a <code>loop_function</code> do this for you. We will demonstrate the first method here.</p>
<p>To construct an initial design, we will use one of the four design generators available in <code>paradox</code>. Let’s try grid search first, assuming an initial design of nine points on a domain of two numeric variables ranging from 0 to 1:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>domain <span class="ot">=</span> <span class="fu">ps</span>(<span class="at">x1 =</span> <span class="fu">p_dbl</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">x2 =</span> <span class="fu">p_dbl</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">generate_design_grid</span>(domain, <span class="at">resolution =</span> <span class="dv">3</span>)<span class="sc">$</span>data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      x1    x2
   &lt;num&gt; &lt;num&gt;
1:   0.0   0.0
2:   0.0   0.5
3:   0.0   1.0
4:   0.5   0.0
5:   0.5   0.5
6:   0.5   1.0
7:   1.0   0.0
8:   1.0   0.5
9:   1.0   1.0</code></pre>
</div>
</div>
<p>As you can see, this is more or less a simple <code>data.table</code> that encodes the set of hyperparameter configurations we want to evaluate first, before any of the real BO magic starts.</p>
<p><strong>Task: Construct a more refined initial design, using <code>paradox</code> to implement a Sobol design with 30 points, which has better coverage properties than grid or random search. If you are interested in why the Sobol design has favorable properties, you can take a look at the original paper by Niederreiter (<a href="https://doi.org/10.1016/0022-314X(88)90025-X">1988</a>).</strong></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+c29ib2xfZGVzaWduIDxzcGFuIGNsYXNzPSJvdCI+PTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5nZW5lcmF0ZV9kZXNpZ25fc29ib2w8L3NwYW4+KGRvbWFpbiwgPHNwYW4gY2xhc3M9ImF0Ij5uID08L3NwYW4+IDxzcGFuIGNsYXNzPSJkdiI+MzA8L3NwYW4+KTxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj5kYXRhPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTIiPjxhIGhyZWY9IiNjYjEtMiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjxzcGFuIGNsYXNzPSJmdSI+aGVhZDwvc3Bhbj4oc29ib2xfZGVzaWduKTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0IGNlbGwtb3V0cHV0LXN0ZG91dCI+CjxwcmU+PGNvZGU+ICAgICAgICAgIHgxICAgICAgICB4MgogICAgICAgJmx0O251bSZndDsgICAgICZsdDtudW0mZ3Q7CjE6IDAuNjIwOTQ5NCAwLjM1MzEyOTUKMjogMC4xMjA5NDk0IDAuODUzMTI5NQozOiAwLjg3MDk0OTQgMC42MDMxMjk1CjQ6IDAuMzcwOTQ5NCAwLjEwMzEyOTUKNTogMC4yNDU5NDk0IDAuNDc4MTI5NQo2OiAwLjc0NTk0OTQgMC45NzgxMjk1PC9jb2RlPjwvcHJlPgo8L2Rpdj4KPC9kaXY+"></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="generate-data-from-initial-design" class="level2">
<h2 class="anchored" data-anchor-id="generate-data-from-initial-design">1.2 Generate data from initial design</h2>
<p>To generate training data for our surrogate model, we need a few more things:</p>
<ul>
<li>An <code>Objective</code> function that wraps the actual mapping from a domain (all possible function inputs) to a codomain (all possible function outputs). Objective functions can be created using different classes, all of which inherit from <code>Objective</code>. Here, we will use <code>ObjectiveRFun</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We have already defined our domain, but will do here again:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>domain <span class="ot">=</span> <span class="fu">ps</span>(<span class="at">x1 =</span> <span class="fu">p_dbl</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">x2 =</span> <span class="fu">p_dbl</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Our codomain:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>codomain <span class="ot">=</span> <span class="fu">ps</span>(<span class="at">y =</span> <span class="fu">p_dbl</span>(<span class="at">tags =</span> <span class="st">"minimize"</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Our objective: </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>objective <span class="ot">=</span> ObjectiveRFun<span class="sc">$</span><span class="fu">new</span>(sinus_1D, <span class="at">domain =</span> domain, <span class="at">codomain =</span> codomain)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Further:</p>
<ul>
<li><code>OptimInstanceSingleCrit</code> to construct an optimization instance that describes the optimization problem and stores the results</li>
<li><code>Optimizer</code> which is used to construct and configure optimization algorithms. Optimization Instance</li>
</ul>
<p>Let’s define our optimization instance and evaluate it on our initial Sobol design:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>instance <span class="ot">=</span> OptimInstanceSingleCrit<span class="sc">$</span><span class="fu">new</span>(objective,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">"evals"</span>, <span class="at">n_evals =</span> <span class="dv">20</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>instance<span class="sc">$</span><span class="fu">eval_batch</span>(sobol_design)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Task: Extract the training archive data from the tuning instance to find the data that we will now use to train our surrogate model with in the first iteration.</strong></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+aW5zdGFuY2U8c3BhbiBjbGFzcz0ic2MiPiQ8L3NwYW4+YXJjaGl2ZTxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj5kYXRhPC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPGRpdiBjbGFzcz0iY2VsbC1vdXRwdXQgY2VsbC1vdXRwdXQtc3Rkb3V0Ij4KPHByZT48Y29kZT4gICAgICAgICAgICB4MSAgICAgICAgIHgyICAgICAgICAgICAgIHkgIHhfZG9tYWluICAgICAgICAgICB0aW1lc3RhbXAgYmF0Y2hfbnIKICAgICAgICAgJmx0O251bSZndDsgICAgICAmbHQ7bnVtJmd0OyAgICAgICAgICZsdDtudW0mZ3Q7ICAgICZsdDtsaXN0Jmd0OyAgICAgICAgICAgICAgJmx0O1BPU2MmZ3Q7ICAgICZsdDtpbnQmZ3Q7CiAxOiAwLjYyMDk0OTQ1IDAuMzUzMTI5NTEgIDEuMDEzMDk3ZS0wMSAmbHQ7bGlzdFsyXSZndDsgMjAyNS0wNS0wMiAwODozNjowNiAgICAgICAgMQogMjogMC4xMjA5NDk0NSAwLjg1MzEyOTUxICAxLjU0MzAzMWUtMDEgJmx0O2xpc3RbMl0mZ3Q7IDIwMjUtMDUtMDIgMDg6MzY6MDYgICAgICAgIDEKIDM6IDAuODcwOTQ5NDUgMC42MDMxMjk1MSAtMi4xNzIwMjdlLTAxICZsdDtsaXN0WzJdJmd0OyAyMDI1LTA1LTAyIDA4OjM2OjA2ICAgICAgICAxCiA0OiAwLjM3MDk0OTQ1IDAuMTAzMTI5NTEgLTYuOTgzMjQzZS0wMyAmbHQ7bGlzdFsyXSZndDsgMjAyNS0wNS0wMiAwODozNjowNiAgICAgICAgMQogNTogMC4yNDU5NDk0NSAwLjQ3ODEyOTUxIC0zLjIxNTU3MGUtMDIgJmx0O2xpc3RbMl0mZ3Q7IDIwMjUtMDUtMDIgMDg6MzY6MDYgICAgICAgIDEKIDY6IDAuNzQ1OTQ5NDUgMC45NzgxMjk1MSAtMS4wMzA0NDdlKzAwICZsdDtsaXN0WzJdJmd0OyAyMDI1LTA1LTAyIDA4OjM2OjA2ICAgICAgICAxCiA3OiAwLjQ5NTk0OTQ1IDAuNzI4MTI5NTEgIDIuOTQ3MjA3ZS0wMSAmbHQ7bGlzdFsyXSZndDsgMjAyNS0wNS0wMiAwODozNjowNiAgICAgICAgMQogODogMC45OTU5NDk0NSAwLjIyODEyOTUxICAxLjAwODQyNGUtMDEgJmx0O2xpc3RbMl0mZ3Q7IDIwMjUtMDUtMDIgMDg6MzY6MDYgICAgICAgIDEKIDk6IDAuNDMzNDQ5NDUgMC4yOTA2Mjk1MSAtMS41Mzk1NDFlLTAyICZsdDtsaXN0WzJdJmd0OyAyMDI1LTA1LTAyIDA4OjM2OjA2ICAgICAgICAxCjEwOiAwLjkzMzQ0OTQ1IDAuNzkwNjI5NTEgIDUuMDQ3NTkyZS0wMSAmbHQ7bGlzdFsyXSZndDsgMjAyNS0wNS0wMiAwODozNjowNiAgICAgICAgMQoxMTogMC4xODM0NDk0NSAwLjU0MDYyOTUxICA1LjUzNzM5OGUtMDIgJmx0O2xpc3RbMl0mZ3Q7IDIwMjUtMDUtMDIgMDg6MzY6MDYgICAgICAgIDEKMTI6IDAuNjgzNDQ5NDUgMC4wNDA2Mjk1MSAtMy4yMjYyOTBlLTA0ICZsdDtsaXN0WzJdJmd0OyAyMDI1LTA1LTAyIDA4OjM2OjA2ICAgICAgICAxCjEzOiAwLjA1ODQ0OTQ0IDAuMTY1NjI5NTEgIDIuMzMwMjg1ZS0wMyAmbHQ7bGlzdFsyXSZndDsgMjAyNS0wNS0wMiAwODozNjowNiAgICAgICAgMQoxNDogMC41NTg0NDk0NSAwLjY2NTYyOTUxICA0LjU4ODIyOGUtMDEgJmx0O2xpc3RbMl0mZ3Q7IDIwMjUtMDUtMDIgMDg6MzY6MDYgICAgICAgIDEKMTU6IDAuODA4NDQ5NDUgMC40MTU2Mjk1MSAtMi41NzMzNTZlLTAxICZsdDtsaXN0WzJdJmd0OyAyMDI1LTA1LTAyIDA4OjM2OjA2ICAgICAgICAxCjE2OiAwLjMwODQ0OTQ1IDAuOTE1NjI5NTEgLTQuMTM1NjIzZS0wMSAmbHQ7bGlzdFsyXSZndDsgMjAyNS0wNS0wMiAwODozNjowNiAgICAgICAgMQoxNzogMC4yNzcxOTk0NSAwLjM4NDM3OTUxIC01LjM4MzQzOGUtMDIgJmx0O2xpc3RbMl0mZ3Q7IDIwMjUtMDUtMDIgMDg6MzY6MDYgICAgICAgIDEKMTg6IDAuNzc3MTk5NDUgMC44ODQzNzk1MSAtMS4wNTYzNDdlKzAwICZsdDtsaXN0WzJdJmd0OyAyMDI1LTA1LTAyIDA4OjM2OjA2ICAgICAgICAxCjE5OiAwLjUyNzE5OTQ1IDAuMTM0Mzc5NTEgIDEuNjg5NzA3ZS0wMiAmbHQ7bGlzdFsyXSZndDsgMjAyNS0wNS0wMiAwODozNjowNiAgICAgICAgMQoyMDogMC4wMjcxOTk0NCAwLjYzNDM3OTUxICA3LjYwMTQ5NmUtMDMgJmx0O2xpc3RbMl0mZ3Q7IDIwMjUtMDUtMDIgMDg6MzY6MDYgICAgICAgIDEKMjE6IDAuNDAyMTk5NDUgMC43NTkzNzk1MSAtMi41NTMxMDhlLTAxICZsdDtsaXN0WzJdJmd0OyAyMDI1LTA1LTAyIDA4OjM2OjA2ICAgICAgICAxCjIyOiAwLjkwMjE5OTQ1IDAuMjU5Mzc5NTEgIDcuNzI3Nzc3ZS0wMyAmbHQ7bGlzdFsyXSZndDsgMjAyNS0wNS0wMiAwODozNjowNiAgICAgICAgMQoyMzogMC42NTIxOTk0NSAwLjUwOTM3OTUxICA5LjM4ODU3MmUtMDIgJmx0O2xpc3RbMl0mZ3Q7IDIwMjUtMDUtMDIgMDg6MzY6MDYgICAgICAgIDEKMjQ6IDAuMTUyMTk5NDUgMC4wMDkzNzk1MSAgMi4yNjg4ODRlLTA1ICZsdDtsaXN0WzJdJmd0OyAyMDI1LTA1LTAyIDA4OjM2OjA2ICAgICAgICAxCjI1OiAwLjMzOTY5OTQ1IDAuNTcxODc5NTEgLTIuMTAwODIwZS0wMSAmbHQ7bGlzdFsyXSZndDsgMjAyNS0wNS0wMiAwODozNjowNiAgICAgICAgMQoyNjogMC44Mzk2OTk0NSAwLjA3MTg3OTUxIC02LjI4MjYwNWUtMDMgJmx0O2xpc3RbMl0mZ3Q7IDIwMjUtMDUtMDIgMDg6MzY6MDYgICAgICAgIDEKMjc6IDAuMDg5Njk5NDUgMC4zMjE4Nzk1MSAgMS43MzY4NzNlLTAyICZsdDtsaXN0WzJdJmd0OyAyMDI1LTA1LTAyIDA4OjM2OjA2ICAgICAgICAxCjI4OiAwLjU4OTY5OTQ1IDAuODIxODc5NTEgIDYuNTM0MTM2ZS0wMSAmbHQ7bGlzdFsyXSZndDsgMjAyNS0wNS0wMiAwODozNjowNiAgICAgICAgMQoyOTogMC40NjQ2OTk0NSAwLjE5Njg3OTUxICA3LjkwMjA1MWUtMDMgJmx0O2xpc3RbMl0mZ3Q7IDIwMjUtMDUtMDIgMDg6MzY6MDYgICAgICAgIDEKMzA6IDAuOTY0Njk5NDUgMC42OTY4Nzk1MSAgNi45NjYwODFlLTAxICZsdDtsaXN0WzJdJmd0OyAyMDI1LTA1LTAyIDA4OjM2OjA2ICAgICAgICAxCiAgICAgICAgICAgIHgxICAgICAgICAgeDIgICAgICAgICAgICAgeSAgeF9kb21haW4gICAgICAgICAgIHRpbWVzdGFtcCBiYXRjaF9ucjwvY29kZT48L3ByZT4KPC9kaXY+CjwvZGl2Pg=="></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="train-surrogate-model" class="level2">
<h2 class="anchored" data-anchor-id="train-surrogate-model">1.3 Train surrogate model</h2>
<p>A surrogate model wraps a regression learner that models the unknown black box function based on observed data. In <code>mlr3mbo</code>, the <code>SurrogateLearner</code> is a higher-level <code>R6</code> class inheriting from the base Surrogate class, designed to construct and manage the surrogate model, including automatic construction of the <code>TaskRegr</code> that the learner should be trained on at each iteration of the BO loop.</p>
<p>Any regression learner in <code>mlr3</code> can be used. However, most acquisition functions depend on both mean and standard deviation predictions from the surrogate model, the latter of which requires the <code>"se"</code> <code>predict_type</code> to be supported. Therefore not all learners are suitable for all scenarios. Typical choices are random forests or Gaussian processes <code>(lrn("regr.km"))</code>, which we will use here. You can learn more about Gaussian processes in Williams and Rasmussen (<a href="https://gaussianprocess.org/gpml/chapters/RW.pdf">2006</a>).</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>lrn_gp <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.km"</span>, <span class="at">covtype =</span> <span class="st">"matern5_2"</span>, <span class="at">optim.method =</span> <span class="st">"BFGS"</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="cn">FALSE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The Matérn covariance function is a kernel used in Gaussian processes to model the smoothness of the random function, offering a flexible class of smoothness parameters. The BFGS algorithm is a type of quasi-Newton method used for optimization, particularly effective in maximizing the likelihood in Gaussian process models by efficiently finding parameter estimates.</p>
<p>A <code>SurrogateLearner</code> can be constructed by passing a <code>LearnerRegr</code> object to the sugar function <code>srlrn()</code>, alongside the archive of the instance:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>surrogate <span class="ot">=</span> <span class="fu">srlrn</span>(lrn_gp, <span class="at">archive =</span> instance<span class="sc">$</span>archive)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Internally, the regression learner is fit on a <code>TaskRegr</code> where features are the variables of the domain and the target is the codomain, the data is from the archive of the <code>OptimInstance</code> that is to be optimized.</p>
<p><strong>Task: Update the surrogate model, which essentially fits the gaussian process. Then, inspect the trained random forest model that is contained within the surrogate:</strong></p>
<details>
<summary>
<strong>Hint 1:</strong>
</summary>
<p>Fitting the surrogate model will require calling one of the methods of <code>surrogate</code>. See <code>?surrogate</code> for help.</p>
</details>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5yZXF1aXJlTmFtZXNwYWNlPC9zcGFuPig8c3BhbiBjbGFzcz0ic3QiPiZxdW90O0RpY2VLcmlnaW5nJnF1b3Q7PC9zcGFuPik8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMiI+PGEgaHJlZj0iI2NiMS0yIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5saWJyYXJ5PC9zcGFuPihEaWNlS3JpZ2luZyk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMyI+PGEgaHJlZj0iI2NiMS0zIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTQiPjxhIGhyZWY9IiNjYjEtNCIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPnN1cnJvZ2F0ZTxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj48c3BhbiBjbGFzcz0iZnUiPnVwZGF0ZTwvc3Bhbj4oKTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS01Ij48YSBocmVmPSIjY2IxLTUiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5zdXJyb2dhdGU8c3BhbiBjbGFzcz0ic2MiPiQ8L3NwYW4+bGVhcm5lcjxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj5tb2RlbDwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0IGNlbGwtb3V0cHV0LXN0ZG91dCI+CjxwcmU+PGNvZGU+CkNhbGw6CkRpY2VLcmlnaW5nOjprbShkZXNpZ24gPSBkYXRhLCByZXNwb25zZSA9IHRydXRoLCBjb3Z0eXBlID0gJnF1b3Q7bWF0ZXJuNV8yJnF1b3Q7LCAKICAgIG9wdGltLm1ldGhvZCA9ICZxdW90O0JGR1MmcXVvdDssIGNvbnRyb2wgPSBwdiRjb250cm9sKQoKVHJlbmQgIGNvZWZmLjoKICAgICAgICAgICAgICAgRXN0aW1hdGUKIChJbnRlcmNlcHQpICAgIC0wLjAxMDMKCkNvdmFyLiB0eXBlICA6IG1hdGVybjVfMiAKQ292YXIuIGNvZWZmLjoKICAgICAgICAgICAgICAgRXN0aW1hdGUKICAgdGhldGEoeDEpICAgICAwLjExNDUKICAgdGhldGEoeDIpICAgICAwLjYzNzIKClZhcmlhbmNlIGVzdGltYXRlOiAwLjE2NTM2MTQ8L2NvZGU+PC9wcmU+CjwvZGl2Pgo8L2Rpdj4="></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="define-an-acquisition-function" class="level2">
<h2 class="anchored" data-anchor-id="define-an-acquisition-function">1.4 Define an acquisition function</h2>
<p>Roughly speaking, an acquisition function relies on the prediction of a surrogate model and quantifies the perceived ‘utility’ of each point of the search space if it were to be evaluated in the next iteration.</p>
<p>A popular example is the <strong>expected improvement</strong>, which tells us how much we can expect a candidate point to improve over the best function value observed so far (the ‘incumbent’), given the performance prediction of the surrogate model. Calculating the expected improvement requires mean and standard deviation predictions from the model.</p>
<p>In <code>mlr3mbo</code>, acquisition functions are stored in the <code>mlr_acqfunctions</code> dictionary and can be constructed with <code>acqf()</code>, passing the key of the method you want to use and our surrogate learner. In our running example, we will use the expected improvement to choose the next candidate for evaluation.</p>
<p><strong>Task: Construct an aquisition function object using expected improvement. Then, update the aquisition function object.</strong></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5yZXF1aXJlTmFtZXNwYWNlPC9zcGFuPig8c3BhbiBjbGFzcz0ic3QiPiZxdW90O0RpY2VLcmlnaW5nJnF1b3Q7PC9zcGFuPik8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMiI+PGEgaHJlZj0iI2NiMS0yIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5saWJyYXJ5PC9zcGFuPihEaWNlS3JpZ2luZyk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMyI+PGEgaHJlZj0iI2NiMS0zIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTQiPjxhIGhyZWY9IiNjYjEtNCIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPmFjcV9mdW5jdGlvbiA8c3BhbiBjbGFzcz0ib3QiPj08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+YWNxZjwvc3Bhbj4oPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtlaSZxdW90Ozwvc3Bhbj4sIDxzcGFuIGNsYXNzPSJhdCI+c3Vycm9nYXRlID08L3NwYW4+IHN1cnJvZ2F0ZSk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtNSI+PGEgaHJlZj0iI2NiMS01IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+YWNxX2Z1bmN0aW9uPHNwYW4gY2xhc3M9InNjIj4kPC9zcGFuPjxzcGFuIGNsYXNzPSJmdSI+dXBkYXRlPC9zcGFuPigpPC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPC9kaXY+CjxwPlRoZSBiZXN0IHktdmFsdWUgdGhlIGFjcXVpc2l0aW9uIGZ1bmN0aW9uIGhhcyBzZWVuIHNvIGZhcjo8L3A+CjxkaXYgY2xhc3M9ImNlbGwiIGRhdGEtbGF5b3V0LWFsaWduPSJjZW50ZXIiPgo8ZGl2IGNsYXNzPSJzb3VyY2VDb2RlIiBpZD0iY2IyIj48cHJlCmNsYXNzPSJzb3VyY2VDb2RlIHIgY2VsbC1jb2RlIj48Y29kZSBjbGFzcz0ic291cmNlQ29kZSByIj48c3BhbiBpZD0iY2IyLTEiPjxhIGhyZWY9IiNjYjItMSIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPmFjcV9mdW5jdGlvbjxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj55X2Jlc3Q8L3NwYW4+PC9jb2RlPjwvcHJlPjwvZGl2Pgo8ZGl2IGNsYXNzPSJjZWxsLW91dHB1dCBjZWxsLW91dHB1dC1zdGRvdXQiPgo8cHJlPjxjb2RlPlsxXSAtMS4wNTYzNDc8L2NvZGU+PC9wcmU+CjwvZGl2Pgo8L2Rpdj4="></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="optimize-acquisition-function" class="level2">
<h2 class="anchored" data-anchor-id="optimize-acquisition-function">1.5 Optimize acquisition function</h2>
<p>Why would we need to optimize the acquisition function? Well, the acquisition function can tell us how “promising” an arbitrary hyperparameter configuration is. If we want to find the “most promising” hyperparameter configuration, we again need to optimize the acquisition function. Consequently the optimization problem of the acquisition function is handled as a black box optimization problem itself, but it is a much cheaper one than the original.</p>
<p>An acquisition function optimizer of class <code>AcqOptimizer</code> is used to optimize the acquisition function by efficiently searching the space of potential candidates within a limited computational budget. Widely used approaches for optimizing acquisition functions include derivative-free global optimization methods, such as the DIRECT algorithm. Consequently the optimization problem of the acquisition function can be handled as a black box optimization problem itself, but a much cheaper one than the original.</p>
<p><code>AcqOptimizer</code> objects are constructed with <code>acqo()</code>, which takes as input an <code>Optimizer</code>, a Terminator, and the acquisition function. Optimizers are stored in the <code>mlr_optimizers</code> dictionary and can be constructed with the sugar function <code>opt()</code>. Let’s select an optimizer first:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>optimizer <span class="ot">=</span> <span class="fu">opt</span>(<span class="st">"nloptr"</span>, <span class="at">algorithm =</span> <span class="st">"NLOPT_GN_ORIG_DIRECT"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Task: Construct an acquisition function optimizer using the optimizer above, a termination criterion of your choice and the acquisition function from the previous exercise. Then, call $optimize() on the optimizer to suggest the next candidate hyperparameter configuration.</strong></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+YWNxX29wdGltaXplciA8c3BhbiBjbGFzcz0ib3QiPj08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+YWNxbzwvc3Bhbj4oPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTIiPjxhIGhyZWY9IiNjYjEtMiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgPHNwYW4gY2xhc3M9ImF0Ij5vcHRpbWl6ZXIgPTwvc3Bhbj4gb3B0aW1pemVyLDwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0zIj48YSBocmVmPSIjY2IxLTMiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4gIDxzcGFuIGNsYXNzPSJhdCI+dGVybWluYXRvciA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPnRybTwvc3Bhbj4oPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtldmFscyZxdW90Ozwvc3Bhbj4sIDxzcGFuIGNsYXNzPSJhdCI+bl9ldmFscyA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iZHYiPjIwMDwvc3Bhbj4pLDwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS00Ij48YSBocmVmPSIjY2IxLTQiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4gIDxzcGFuIGNsYXNzPSJhdCI+YWNxX2Z1bmN0aW9uID08L3NwYW4+IGFjcV9mdW5jdGlvbjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS01Ij48YSBocmVmPSIjY2IxLTUiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4pPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTYiPjxhIGhyZWY9IiNjYjEtNiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS03Ij48YSBocmVmPSIjY2IxLTciIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5jYW5kaWRhdGUgPHNwYW4gY2xhc3M9Im90Ij49PC9zcGFuPiBhY3Ffb3B0aW1pemVyPHNwYW4gY2xhc3M9InNjIj4kPC9zcGFuPjxzcGFuIGNsYXNzPSJmdSI+b3B0aW1pemU8L3NwYW4+KCk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtOCI+PGEgaHJlZj0iI2NiMS04IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+Y2FuZGlkYXRlPC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPGRpdiBjbGFzcz0iY2VsbC1vdXRwdXQgY2VsbC1vdXRwdXQtc3Rkb3V0Ij4KPHByZT48Y29kZT4gICAgICAgICB4MSAgICAgICAgeDIgICAgIGFjcV9laSAgeF9kb21haW4gLmFscmVhZHlfZXZhbHVhdGVkCiAgICAgICZsdDtudW0mZ3Q7ICAgICAmbHQ7bnVtJmd0OyAgICAgICZsdDtudW0mZ3Q7ICAgICZsdDtsaXN0Jmd0OyAgICAgICAgICAgICAmbHQ7bGdjbCZndDsKMTogMC43Nzc4NTQgMC45OTk5MjM4IDAuMDc3Mzc4MjMgJmx0O2xpc3RbMl0mZ3Q7ICAgICAgICAgICAgICBGQUxTRTwvY29kZT48L3ByZT4KPC9kaXY+CjwvZGl2Pgo8cD5UaGlzIGlzIHRoZSBuZXh0IGh5cGVycGFyYW1ldGVyIGNvbmZpZ3VyYXRpb24gd2Ugd291bGQgd2FudCB0bwpldmFsdWF0ZS4gVGhpcyByZXN0YXJ0cyB0aGUgbG9vcDogYWRkIGl0IHRvIHRoZSBhcmNoaXZlLCB0cmFpbiBzdXJyb2dhdGUKbW9kZWwsIG9wdGltaXplIHRoZSBhY3F1aXNpdGlvbiBmdW5jdGlvbiB3aXRoIHRoZSBuZXcgc3Vycm9nYXRlIG1vZGVsLApnZXQgdGhlIG5leHQgY2FuZGlkYXRlLCBldGMuIFdlIHdvdWxkIGRvIHRoaXMgdW50aWwgc29tZSB0ZXJtaW5hdGlvbgpjcml0ZXJpb24gaXMgbWV0LjwvcD4="></div></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="automating-bo-with-optimizermbo" class="level1">
<h1>2 Automating BO with <code>OptimizerMbo</code></h1>
<p>We have now shown how to run a single iteration of the BO algorithm loop manually. In practice, one would use <code>OptimizerMbo</code> to put all these pieces together to automate the process. To determine the behavior of the BO algorithm on a global level, we need a <strong>loop function</strong>. We use the Efficient Global Optimization (EGO) algorithm, aka <code>bayesopt_ego</code> provided by <code>mlr_loop_functions</code>. You do not need to pass any of these building blocks to each other manually as the <code>opt()</code> constructor will do this for you:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>loop_function <span class="ot">=</span> mlr_loop_functions<span class="sc">$</span><span class="fu">get</span>(<span class="st">"bayesopt_ego"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>surrogate <span class="ot">=</span> <span class="fu">srlrn</span>(<span class="fu">lrn</span>(<span class="st">"regr.km"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">covtype =</span> <span class="st">"matern5_2"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">optim.method =</span> <span class="st">"BFGS"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>acq_function <span class="ot">=</span> <span class="fu">acqf</span>(<span class="st">"ei"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>acq_optimizer <span class="ot">=</span> <span class="fu">acqo</span>(<span class="fu">opt</span>(<span class="st">"nloptr"</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">algorithm =</span> <span class="st">"NLOPT_GN_ORIG_DIRECT"</span>),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">"evals"</span>, <span class="at">n_evals =</span> <span class="dv">100</span>))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>optimizer <span class="ot">=</span> <span class="fu">opt</span>(<span class="st">"mbo"</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">loop_function =</span> loop_function,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">surrogate =</span> surrogate,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">acq_function =</span> acq_function,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">acq_optimizer =</span> acq_optimizer)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Task: Use the MBO optimizer constructed above to solve the optimization problem. To do so, define an optimization instance (as in 1.2) and an initial design (as in 1.1). Then, evaluate the optimization instance on the initial design (as in 1.2). Then, call <code>optimizer$optimize()</code> on the instance.</strong></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+aW5zdGFuY2UgPHNwYW4gY2xhc3M9Im90Ij49PC9zcGFuPiBPcHRpbUluc3RhbmNlU2luZ2xlQ3JpdDxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj48c3BhbiBjbGFzcz0iZnUiPm5ldzwvc3Bhbj4ob2JqZWN0aXZlLDwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0yIj48YSBocmVmPSIjY2IxLTIiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4gIDxzcGFuIGNsYXNzPSJhdCI+dGVybWluYXRvciA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPnRybTwvc3Bhbj4oPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtldmFscyZxdW90Ozwvc3Bhbj4sIDxzcGFuIGNsYXNzPSJhdCI+bl9ldmFscyA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iZHYiPjEwMDwvc3Bhbj4pKTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0zIj48YSBocmVmPSIjY2IxLTMiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5zb2JvbF9kZXNpZ24gPHNwYW4gY2xhc3M9Im90Ij49PC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPmdlbmVyYXRlX2Rlc2lnbl9zb2JvbDwvc3Bhbj4oZG9tYWluLCA8c3BhbiBjbGFzcz0iYXQiPm4gPTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImR2Ij4xMDA8L3NwYW4+KTxzcGFuIGNsYXNzPSJzYyI+JDwvc3Bhbj5kYXRhPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTQiPjxhIGhyZWY9IiNjYjEtNCIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPmluc3RhbmNlPHNwYW4gY2xhc3M9InNjIj4kPC9zcGFuPjxzcGFuIGNsYXNzPSJmdSI+ZXZhbF9iYXRjaDwvc3Bhbj4oc29ib2xfZGVzaWduKTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS01Ij48YSBocmVmPSIjY2IxLTUiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5vcHRpbWl6ZXI8c3BhbiBjbGFzcz0ic2MiPiQ8L3NwYW4+PHNwYW4gY2xhc3M9ImZ1Ij5vcHRpbWl6ZTwvc3Bhbj4oaW5zdGFuY2UpPC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPGRpdiBjbGFzcz0iY2VsbC1vdXRwdXQgY2VsbC1vdXRwdXQtc3Rkb3V0Ij4KPHByZT48Y29kZT4gICAgICAgICAgeDEgICAgICAgIHgyICB4X2RvbWFpbiAgICAgICAgICB5CiAgICAgICAmbHQ7bnVtJmd0OyAgICAgJmx0O251bSZndDsgICAgJmx0O2xpc3QmZ3Q7ICAgICAgJmx0O251bSZndDsKMTogMC44MDYxODA1IDAuODIzMTc5NCAmbHQ7bGlzdFsyXSZndDsgLTAuOTMyMzg5NjwvY29kZT48L3ByZT4KPC9kaXY+CjwvZGl2Pg=="></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="bo-for-hpo-with-tunermbo" class="level1">
<h1>3 BO for HPO with <code>TunerMbo</code></h1>
<p><code>mlr3mbo</code> can be used for HPO by making use of <code>TunerMbo</code>, which is a wrapper around <code>OptimizerMbo</code> and works in the exact same way. As an example, we want to tune the cost and gamma parameters of <code>lrn("classif.svm")</code> with a radial kernel on <code>tsk("sonar")</code> with three-fold CV.</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>lrn_svm <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.svm"</span>, <span class="at">kernel =</span> <span class="st">"radial"</span>,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"C-classification"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cost  =</span> <span class="fu">to_tune</span>(<span class="fl">1e-5</span>, <span class="fl">1e5</span>, <span class="at">logscale =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="fu">to_tune</span>(<span class="fl">1e-5</span>, <span class="fl">1e5</span>, <span class="at">logscale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>tuner <span class="ot">=</span> <span class="fu">tnr</span>(<span class="st">"mbo"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">loop_function =</span> bayesopt_ego,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">surrogate =</span> surrogate,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">acq_function =</span> acq_function,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">acq_optimizer =</span> acq_optimizer)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Task: Run the tuner on the lrn_svm for the sonar task and 3-fold CV. Use misclassification error as performance measure. What is the best HP configuration?</strong></p>
<details>
<summary>
<strong>Hint 1:</strong>
</summary>
<p>See <code>?mlr3tuning::tune</code> for help.</p>
</details>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+aW5zdGFuY2UgPHNwYW4gY2xhc3M9Im90Ij49PC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPnR1bmU8L3NwYW4+KHR1bmVyLDwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0yIj48YSBocmVmPSIjY2IxLTIiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZ1Ij50c2s8L3NwYW4+KDxzcGFuIGNsYXNzPSJzdCI+JnF1b3Q7c29uYXImcXVvdDs8L3NwYW4+KSw8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMyI+PGEgaHJlZj0iI2NiMS0zIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICAgICAgICAgICAgICAgIGxybl9zdm0sPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTQiPjxhIGhyZWY9IiNjYjEtNCIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZnUiPnJzbXA8L3NwYW4+KDxzcGFuIGNsYXNzPSJzdCI+JnF1b3Q7Y3YmcXVvdDs8L3NwYW4+LCA8c3BhbiBjbGFzcz0iYXQiPmZvbGRzID08L3NwYW4+IDxzcGFuIGNsYXNzPSJkdiI+Mzwvc3Bhbj4pLDwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS01Ij48YSBocmVmPSIjY2IxLTUiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZ1Ij5tc3I8L3NwYW4+KDxzcGFuIGNsYXNzPSJzdCI+JnF1b3Q7Y2xhc3NpZi5jZSZxdW90Ozwvc3Bhbj4pLCA8c3BhbiBjbGFzcz0iZHYiPjI1PC9zcGFuPik8L3NwYW4+PC9jb2RlPjwvcHJlPjwvZGl2Pgo8ZGl2IGNsYXNzPSJjZWxsLW91dHB1dCBjZWxsLW91dHB1dC1zdGRvdXQiPgo8cHJlPjxjb2RlPklORk8gIFswODozNjoxMC4wMjNdIFttbHIzXSBSdW5uaW5nIGJlbmNobWFyayB3aXRoIDI0IHJlc2FtcGxpbmcgaXRlcmF0aW9ucwpJTkZPICBbMDg6MzY6MTAuMTU1XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMS8zKQpJTkZPICBbMDg6MzY6MTAuMjY2XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMi8zKQpJTkZPICBbMDg6MzY6MTAuMzY5XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMy8zKQpJTkZPICBbMDg6MzY6MTAuNDc1XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMS8zKQpJTkZPICBbMDg6MzY6MTAuNTc4XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMi8zKQpJTkZPICBbMDg6MzY6MTAuNjgzXSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMy8zKQpJTkZPICBbMDg6MzY6MTAuNzk0XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMS8zKQpJTkZPICBbMDg6MzY6MTAuODk3XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMi8zKQpJTkZPICBbMDg6MzY6MTEuMDA4XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMy8zKQpJTkZPICBbMDg6MzY6MTEuMTE4XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMS8zKQpJTkZPICBbMDg6MzY6MTEuMTUyXSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMi8zKQpJTkZPICBbMDg6MzY6MTEuMTk4XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMy8zKQpJTkZPICBbMDg6MzY6MTEuMjQzXSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMS8zKQpJTkZPICBbMDg6MzY6MTEuMjg1XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMi8zKQpJTkZPICBbMDg6MzY6MTEuMzI3XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMy8zKQpJTkZPICBbMDg6MzY6MTEuMzcxXSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMS8zKQpJTkZPICBbMDg6MzY6MTEuNDEzXSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMi8zKQpJTkZPICBbMDg6MzY6MTEuNDU2XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMy8zKQpJTkZPICBbMDg6MzY6MTEuNDk4XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMS8zKQpJTkZPICBbMDg6MzY6MTEuNTQyXSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMi8zKQpJTkZPICBbMDg6MzY6MTEuNTU0XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMy8zKQpJTkZPICBbMDg6MzY6MTEuNTk2XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMS8zKQpJTkZPICBbMDg6MzY6MTEuNjM4XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMi8zKQpJTkZPICBbMDg6MzY6MTEuNjgzXSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMy8zKQpJTkZPICBbMDg6MzY6MTEuNjk5XSBbbWxyM10gRmluaXNoZWQgYmVuY2htYXJrCklORk8gIFswODozNjoxMi44NDVdIFttbHIzXSBSdW5uaW5nIGJlbmNobWFyayB3aXRoIDMgcmVzYW1wbGluZyBpdGVyYXRpb25zCklORk8gIFswODozNjoxMi44NzhdIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAxLzMpCklORk8gIFswODozNjoxMi45MDddIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAyLzMpCklORk8gIFswODozNjoxMi45MzZdIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAzLzMpCklORk8gIFswODozNjoxMi45NDZdIFttbHIzXSBGaW5pc2hlZCBiZW5jaG1hcmsKSU5GTyAgWzA4OjM2OjEzLjk5NV0gW21scjNdIFJ1bm5pbmcgYmVuY2htYXJrIHdpdGggMyByZXNhbXBsaW5nIGl0ZXJhdGlvbnMKSU5GTyAgWzA4OjM2OjE0LjAyN10gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDEvMykKSU5GTyAgWzA4OjM2OjE0LjA1Nl0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDIvMykKSU5GTyAgWzA4OjM2OjE0LjA4NF0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDMvMykKSU5GTyAgWzA4OjM2OjE0LjA5Ml0gW21scjNdIEZpbmlzaGVkIGJlbmNobWFyawpJTkZPICBbMDg6MzY6MTUuMTY4XSBbbWxyM10gUnVubmluZyBiZW5jaG1hcmsgd2l0aCAzIHJlc2FtcGxpbmcgaXRlcmF0aW9ucwpJTkZPICBbMDg6MzY6MTUuMjAwXSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMS8zKQpJTkZPICBbMDg6MzY6MTUuMjM5XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMi8zKQpJTkZPICBbMDg6MzY6MTUuMjg1XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMy8zKQpJTkZPICBbMDg6MzY6MTUuMjkyXSBbbWxyM10gRmluaXNoZWQgYmVuY2htYXJrCklORk8gIFswODozNjoxNi40MTZdIFttbHIzXSBSdW5uaW5nIGJlbmNobWFyayB3aXRoIDMgcmVzYW1wbGluZyBpdGVyYXRpb25zCklORk8gIFswODozNjoxNi40NDddIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAxLzMpCklORk8gIFswODozNjoxNi40NzZdIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAyLzMpCklORk8gIFswODozNjoxNi41MDRdIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAzLzMpCklORk8gIFswODozNjoxNi41MTJdIFttbHIzXSBGaW5pc2hlZCBiZW5jaG1hcmsKSU5GTyAgWzA4OjM2OjE3LjY2N10gW21scjNdIFJ1bm5pbmcgYmVuY2htYXJrIHdpdGggMyByZXNhbXBsaW5nIGl0ZXJhdGlvbnMKSU5GTyAgWzA4OjM2OjE3LjY5OF0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDEvMykKSU5GTyAgWzA4OjM2OjE3Ljc1MV0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDIvMykKSU5GTyAgWzA4OjM2OjE3LjgwMV0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDMvMykKSU5GTyAgWzA4OjM2OjE3LjgwOV0gW21scjNdIEZpbmlzaGVkIGJlbmNobWFyawpJTkZPICBbMDg6MzY6MTkuMDA2XSBbbWxyM10gUnVubmluZyBiZW5jaG1hcmsgd2l0aCAzIHJlc2FtcGxpbmcgaXRlcmF0aW9ucwpJTkZPICBbMDg6MzY6MTkuMDM3XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMS8zKQpJTkZPICBbMDg6MzY6MTkuMDY2XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMi8zKQpJTkZPICBbMDg6MzY6MTkuMDk4XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMy8zKQpJTkZPICBbMDg6MzY6MTkuMTA0XSBbbWxyM10gRmluaXNoZWQgYmVuY2htYXJrCklORk8gIFswODozNjoyMC4wNDhdIFttbHIzXSBSdW5uaW5nIGJlbmNobWFyayB3aXRoIDMgcmVzYW1wbGluZyBpdGVyYXRpb25zCklORk8gIFswODozNjoyMC4wNzldIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAxLzMpCklORk8gIFswODozNjoyMC4xMDhdIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAyLzMpCklORk8gIFswODozNjoyMC4xNDBdIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAzLzMpCklORk8gIFswODozNjoyMC4xNDldIFttbHIzXSBGaW5pc2hlZCBiZW5jaG1hcmsKSU5GTyAgWzA4OjM2OjIxLjE0Nl0gW21scjNdIFJ1bm5pbmcgYmVuY2htYXJrIHdpdGggMyByZXNhbXBsaW5nIGl0ZXJhdGlvbnMKSU5GTyAgWzA4OjM2OjIxLjE4MF0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDEvMykKSU5GTyAgWzA4OjM2OjIxLjIyNV0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDIvMykKSU5GTyAgWzA4OjM2OjIxLjI1NV0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDMvMykKSU5GTyAgWzA4OjM2OjIxLjI2Ml0gW21scjNdIEZpbmlzaGVkIGJlbmNobWFyawpJTkZPICBbMDg6MzY6MjIuMjYwXSBbbWxyM10gUnVubmluZyBiZW5jaG1hcmsgd2l0aCAzIHJlc2FtcGxpbmcgaXRlcmF0aW9ucwpJTkZPICBbMDg6MzY6MjIuMjkxXSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMS8zKQpJTkZPICBbMDg6MzY6MjIuMzIwXSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMi8zKQpJTkZPICBbMDg6MzY6MjIuMzQ4XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMy8zKQpJTkZPICBbMDg6MzY6MjIuMzU2XSBbbWxyM10gRmluaXNoZWQgYmVuY2htYXJrCklORk8gIFswODozNjoyMy4zOThdIFttbHIzXSBSdW5uaW5nIGJlbmNobWFyayB3aXRoIDMgcmVzYW1wbGluZyBpdGVyYXRpb25zCklORk8gIFswODozNjoyMy40MzBdIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAxLzMpCklORk8gIFswODozNjoyMy40NTldIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAyLzMpCklORk8gIFswODozNjoyMy40ODhdIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAzLzMpCklORk8gIFswODozNjoyMy40OTVdIFttbHIzXSBGaW5pc2hlZCBiZW5jaG1hcmsKSU5GTyAgWzA4OjM2OjI0LjUwOV0gW21scjNdIFJ1bm5pbmcgYmVuY2htYXJrIHdpdGggMyByZXNhbXBsaW5nIGl0ZXJhdGlvbnMKSU5GTyAgWzA4OjM2OjI0LjUzOV0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDEvMykKSU5GTyAgWzA4OjM2OjI0LjU2OF0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDIvMykKSU5GTyAgWzA4OjM2OjI0LjU5N10gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDMvMykKSU5GTyAgWzA4OjM2OjI0LjYwNF0gW21scjNdIEZpbmlzaGVkIGJlbmNobWFyawpJTkZPICBbMDg6MzY6MjUuNjY2XSBbbWxyM10gUnVubmluZyBiZW5jaG1hcmsgd2l0aCAzIHJlc2FtcGxpbmcgaXRlcmF0aW9ucwpJTkZPICBbMDg6MzY6MjUuNjk4XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMS8zKQpJTkZPICBbMDg6MzY6MjUuNzI3XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMi8zKQpJTkZPICBbMDg6MzY6MjUuNzU2XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMy8zKQpJTkZPICBbMDg6MzY6MjUuNzYzXSBbbWxyM10gRmluaXNoZWQgYmVuY2htYXJrCklORk8gIFswODozNjoyNi44MjZdIFttbHIzXSBSdW5uaW5nIGJlbmNobWFyayB3aXRoIDMgcmVzYW1wbGluZyBpdGVyYXRpb25zCklORk8gIFswODozNjoyNi44NTddIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAxLzMpCklORk8gIFswODozNjoyNi44ODZdIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAyLzMpCklORk8gIFswODozNjoyNi45MTVdIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAzLzMpCklORk8gIFswODozNjoyNi45MjVdIFttbHIzXSBGaW5pc2hlZCBiZW5jaG1hcmsKSU5GTyAgWzA4OjM2OjI4LjAzNV0gW21scjNdIFJ1bm5pbmcgYmVuY2htYXJrIHdpdGggMyByZXNhbXBsaW5nIGl0ZXJhdGlvbnMKSU5GTyAgWzA4OjM2OjI4LjA2Nl0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDEvMykKSU5GTyAgWzA4OjM2OjI4LjA5NV0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDIvMykKSU5GTyAgWzA4OjM2OjI4LjEyNF0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDMvMykKSU5GTyAgWzA4OjM2OjI4LjEzMV0gW21scjNdIEZpbmlzaGVkIGJlbmNobWFyawpJTkZPICBbMDg6MzY6MjkuMjE3XSBbbWxyM10gUnVubmluZyBiZW5jaG1hcmsgd2l0aCAzIHJlc2FtcGxpbmcgaXRlcmF0aW9ucwpJTkZPICBbMDg6MzY6MjkuMjQ4XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMS8zKQpJTkZPICBbMDg6MzY6MjkuMjc3XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMi8zKQpJTkZPICBbMDg6MzY6MjkuMzA2XSBbbWxyM10gQXBwbHlpbmcgbGVhcm5lciAmIzM5O2NsYXNzaWYuc3ZtJiMzOTsgb24gdGFzayAmIzM5O3NvbmFyJiMzOTsgKGl0ZXIgMy8zKQpJTkZPICBbMDg6MzY6MjkuMzEyXSBbbWxyM10gRmluaXNoZWQgYmVuY2htYXJrCklORk8gIFswODozNjozMC40NTNdIFttbHIzXSBSdW5uaW5nIGJlbmNobWFyayB3aXRoIDMgcmVzYW1wbGluZyBpdGVyYXRpb25zCklORk8gIFswODozNjozMC40ODVdIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAxLzMpCklORk8gIFswODozNjozMC41MTRdIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAyLzMpCklORk8gIFswODozNjozMC41NDNdIFttbHIzXSBBcHBseWluZyBsZWFybmVyICYjMzk7Y2xhc3NpZi5zdm0mIzM5OyBvbiB0YXNrICYjMzk7c29uYXImIzM5OyAoaXRlciAzLzMpCklORk8gIFswODozNjozMC41NTBdIFttbHIzXSBGaW5pc2hlZCBiZW5jaG1hcmsKSU5GTyAgWzA4OjM2OjMxLjc2NF0gW21scjNdIFJ1bm5pbmcgYmVuY2htYXJrIHdpdGggMyByZXNhbXBsaW5nIGl0ZXJhdGlvbnMKSU5GTyAgWzA4OjM2OjMxLjc5NV0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDEvMykKSU5GTyAgWzA4OjM2OjMxLjgyM10gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDIvMykKSU5GTyAgWzA4OjM2OjMxLjg1Ml0gW21scjNdIEFwcGx5aW5nIGxlYXJuZXIgJiMzOTtjbGFzc2lmLnN2bSYjMzk7IG9uIHRhc2sgJiMzOTtzb25hciYjMzk7IChpdGVyIDMvMykKSU5GTyAgWzA4OjM2OjMxLjg1OF0gW21scjNdIEZpbmlzaGVkIGJlbmNobWFyazwvY29kZT48L3ByZT4KPC9kaXY+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjMiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjMtMSI+PGEgaHJlZj0iI2NiMy0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+aW5zdGFuY2U8c3BhbiBjbGFzcz0ic2MiPiQ8L3NwYW4+cmVzdWx0PC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPGRpdiBjbGFzcz0iY2VsbC1vdXRwdXQgY2VsbC1vdXRwdXQtc3Rkb3V0Ij4KPHByZT48Y29kZT4gICAgICAgY29zdCAgICAgZ2FtbWEgbGVhcm5lcl9wYXJhbV92YWxzICB4X2RvbWFpbiBjbGFzc2lmLmNlCiAgICAgICZsdDtudW0mZ3Q7ICAgICAmbHQ7bnVtJmd0OyAgICAgICAgICAgICAmbHQ7bGlzdCZndDsgICAgJmx0O2xpc3QmZ3Q7ICAgICAgJmx0O251bSZndDsKMTogMy44MzgyMjcgLTMuODM5Mzk3ICAgICAgICAgICZsdDtsaXN0WzRdJmd0OyAmbHQ7bGlzdFsyXSZndDsgIDAuMTA1ODY2MTwvY29kZT48L3ByZT4KPC9kaXY+CjwvZGl2Pg=="></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
<p>We have learned how Bayesian Optimization can be used to solve black box optimization problems, and HPO problems specifically. Rather than simply spending a compute budget on evaluating arbitrary configurations, we optimize an acquisition function based on a surrogate model that maps hyperparameter configurations to their estimated generalization performance, to iteratively suggest new candidates.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mlr-org\.com\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Created with <i class="bi bi-heart-fill"></i> for #rstats.</p>
</div>   
    <div class="nav-footer-center">
<p>CC BY SA 4.0</p>
</div>
    <div class="nav-footer-right">
<p>Website powered by <a href="https://quarto.org/">quarto</a> and <a href="https://www.netlify.com/">Netlify</a>.</p>
</div>
  </div>
</footer>




</body></html>