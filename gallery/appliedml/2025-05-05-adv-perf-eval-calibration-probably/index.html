<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Giuseppe Casalicchio">
<meta name="author" content="Essential Data Science Training GmbH">
<meta name="description" content="Learn the basics of tidymodels for supervised learning, assess if a model is well-calibrated, and calibrate it with probably.">

<title>Calibration with probably – mlr-org</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-1fa5e93acb50773330e542bbd58c1e25.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 2,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 5,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">mlr-org</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-overview" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Overview</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-overview">    
        <li>
    <a class="dropdown-item" href="../../../ecosystem.html">
 <span class="dropdown-text">Ecosystem</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../dependencies.html">
 <span class="dropdown-text">Dependencies</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../../tasks.html">
 <span class="dropdown-text">Tasks</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../learners.html">
 <span class="dropdown-text">Learners</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../resamplings.html">
 <span class="dropdown-text">Resamplings</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../measures.html">
 <span class="dropdown-text">Measures</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../../pipeops.html">
 <span class="dropdown-text">Pipeline Operators</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../graphs.html">
 <span class="dropdown-text">Graphs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../torch_pipeops.html">
 <span class="dropdown-text">Torch Pipeline Operators</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../../tuners.html">
 <span class="dropdown-text">Tuners</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../tuning_spaces.html">
 <span class="dropdown-text">Tuning Spaces</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../terminators.html">
 <span class="dropdown-text">Terminators</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../../filters.html">
 <span class="dropdown-text">Feature Selection Filter</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../fselectors.html">
 <span class="dropdown-text">Feature Selection Wrapper</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../book.html"> 
<span class="menu-text">Book</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../gallery.html"> 
<span class="menu-text">Gallery</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-benchmarks" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Benchmarks</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-benchmarks">    
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_mlr3.html">
 <span class="dropdown-text">mlr3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_mlr3fselect.html">
 <span class="dropdown-text">mlr3fselect</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_mlr3tuning.html">
 <span class="dropdown-text">mlr3tuning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_async.html">
 <span class="dropdown-text">mlr3tuning async</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmark_rush.html">
 <span class="dropdown-text">rush</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../benchmarks/benchmarks_paradox.html">
 <span class="dropdown-text">paradox</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../team.html"> 
<span class="menu-text">Team</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-more" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">More</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-more">    
        <li>
    <a class="dropdown-item" href="../../../support.html">
 <span class="dropdown-text">Support</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contributing.html">
 <span class="dropdown-text">Contributing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../faq.html">
 <span class="dropdown-text">Frequently Asked Questions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../blogroll.html">
 <span class="dropdown-text">Blogroll</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-rss" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-rss">    
        <li>
    <a class="dropdown-item" href="../../../gallery-all.xml">
 <span class="dropdown-text">Gallery RSS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite"> <i class="bi bi-chat-dots" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://stackoverflow.com/questions/tagged/mlr3"> <i class="bi bi-stack-overflow" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mlr-org"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Calibration with probably</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
  <div id="quarto-announcement" data-announcement-id="2a29a73f7e8b4063ece399653c838ff3" class="alert alert-primary hidden"><i class="bi bi-info-circle quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p>The website features runtime <a href="benchmarks/benchmarks_paradox.qmd">benchmarks</a> of the paradox package now.</p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Calibration with probably</h1>
                  <div>
        <div class="description">
          <p>Learn the basics of <code>tidymodels</code> for supervised learning, assess if a model is well-calibrated, and calibrate it with <code>probably</code>.</p>
        </div>
      </div>
                </div>
  </div>

  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Authors</div>
      <div class="quarto-title-meta-contents">
               <p>Giuseppe Casalicchio </p>
               <p><a href="https://www.essentialds.de">Essential Data Science Training GmbH</a> </p>
            </div>
    </div>
      
    
      
    </div>
    

  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#goal" id="toc-goal" class="nav-link active" data-scroll-target="#goal">Goal</a></li>
  <li><a href="#required-packages" id="toc-required-packages" class="nav-link" data-scroll-target="#required-packages">Required packages</a></li>
  <li><a href="#data-predicting-cell-segmentation-quality" id="toc-data-predicting-cell-segmentation-quality" class="nav-link" data-scroll-target="#data-predicting-cell-segmentation-quality">Data: predicting cell segmentation quality</a></li>
  <li><a href="#checking-cardinality-properties" id="toc-checking-cardinality-properties" class="nav-link" data-scroll-target="#checking-cardinality-properties">1 Checking cardinality properties</a>
  <ul class="collapse">
  <li><a href="#creating-a-split-with-rsample" id="toc-creating-a-split-with-rsample" class="nav-link" data-scroll-target="#creating-a-split-with-rsample">1.1 Creating a split with rsample</a></li>
  <li><a href="#training-a-naive-bayes-model" id="toc-training-a-naive-bayes-model" class="nav-link" data-scroll-target="#training-a-naive-bayes-model">1.2 Training a Naive Bayes model</a></li>
  <li><a href="#predicting-on-unseen-test-data" id="toc-predicting-on-unseen-test-data" class="nav-link" data-scroll-target="#predicting-on-unseen-test-data">1.3 Predicting on unseen test data</a></li>
  <li><a href="#assessing-model-performance" id="toc-assessing-model-performance" class="nav-link" data-scroll-target="#assessing-model-performance">1.4 Assessing model performance</a></li>
  <li><a href="#assessing-model-calibration" id="toc-assessing-model-calibration" class="nav-link" data-scroll-target="#assessing-model-calibration">1.5 Assessing model calibration</a></li>
  </ul></li>
  <li><a href="#platt-scaling" id="toc-platt-scaling" class="nav-link" data-scroll-target="#platt-scaling">2 Platt scaling</a>
  <ul class="collapse">
  <li><a href="#platt-scaling-with-base-r" id="toc-platt-scaling-with-base-r" class="nav-link" data-scroll-target="#platt-scaling-with-base-r">2.1 Platt scaling with {base R}</a></li>
  <li><a href="#task" id="toc-task" class="nav-link" data-scroll-target="#task">2.1.1 Task</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">2.1.2 Discussion</a></li>
  <li><a href="#platt-scaling-with-probably" id="toc-platt-scaling-with-probably" class="nav-link" data-scroll-target="#platt-scaling-with-probably">2.2 Platt scaling with {probably}</a></li>
  <li><a href="#task-1" id="toc-task-1" class="nav-link" data-scroll-target="#task-1">2.2.1 Task</a></li>
  <li><a href="#discussion-1" id="toc-discussion-1" class="nav-link" data-scroll-target="#discussion-1">2.2.2 Discussion</a></li>
  </ul></li>
  <li><a href="#isotonic-regression" id="toc-isotonic-regression" class="nav-link" data-scroll-target="#isotonic-regression">3 Isotonic regression</a></li>
  <li><a href="#resamping-for-calibration-with-probably" id="toc-resamping-for-calibration-with-probably" class="nav-link" data-scroll-target="#resamping-for-calibration-with-probably">4 Resamping for Calibration with probably</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<script>
const correctHash = "288280f289520aa6fb221ca3a16e024958bb131a0dcabbca6a5439023d6a2e4e";   // value injected by knitr

/* ---------- reusable helper ---------- */
function b64DecodeUtf8(b64) {
  // 1) atob  -> binary-string   (bytes 0…255)
  // 2) map   -> Uint8Array      (array of bytes)
  // 3) TextDecoder('utf-8')     -> real JS string
  const bytes = Uint8Array.from(atob(b64), c => c.charCodeAt(0));
  return new TextDecoder('utf-8').decode(bytes);
}

async function sha256(txt) {
  const buf = await crypto.subtle.digest('SHA-256',
                 new TextEncoder().encode(txt));
  return Array.from(new Uint8Array(buf))
              .map(b => b.toString(16).padStart(2, '0')).join('');
}

async function unlockOne(btn) {
  const pass = prompt("Password:");
  if (!pass) return;
  if (await sha256(pass) !== correctHash) {
    alert("Wrong password"); return;
  }

  /* --- decode only the solution that belongs to THIS button --- */
  const wrapper = btn.parentElement;             // .b64-wrapper
  wrapper.querySelectorAll('.hidden-solution').forEach(div => {
    div.innerHTML = b64DecodeUtf8(div.dataset.encoded);
    div.classList.remove('hidden-solution');
    div.style.display = 'block';
  });

  /* Remove the button so the user can’t click it again */
  btn.remove();
}
</script>

<noscript>
<div style="border: 1px solid #ccc; padding: 1em; margin-top: 1em; background: #f9f9f9;">
    <strong>JavaScript is required to unlock solutions.</strong><br>
    Please enable JavaScript and reload the page,<br>
    or download the source files from
    <a href="https://github.com/mlr-org/mlr3website/" target="_blank" rel="noopener noreferrer">GitHub</a>
    and run the code locally.
  </div>
</noscript>
<section id="goal" class="level1">
<h1>Goal</h1>
<p>Our goal for this exercise sheet is to learn the basics of <code>tidymodels</code> for supervised learning, assess if a model is well-calibrated, and calibrate it with <code>probably</code>. We will do so by using a train-validate-test split: the model is first fitted on training data and then calibrated on validation data. Test data will be used to compare the performance of the un-calibrated and calibrated models. Later, we will see how <code>probably</code> can be used to construct more refined resampling workflows for calibration.</p>
</section>
<section id="required-packages" class="level1">
<h1>Required packages</h1>
<p>We will use <code>tidymodels</code> for machine learning and <code>probably</code> for calibration:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(probably)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(discrim)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="data-predicting-cell-segmentation-quality" class="level1">
<h1>Data: predicting cell segmentation quality</h1>
<p>The <code>modeldata</code> package contains a data set called <code>cells</code>. Initially distributed by <a href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-8-340">Hill and Haney (2007)</a>, they showed how to create models that predict the <em>quality</em> of the image analysis of cells. The outcome has two levels <code>"PS"</code> (for poorly segmented images) or <code>"WS"</code> (well-segmented). There are 56 image features that can be used to build a classifier.</p>
<p>Let’s load the data and remove an unwanted column:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cells)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>cells<span class="sc">$</span>case <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="checking-cardinality-properties" class="level1">
<h1>1 Checking cardinality properties</h1>
<section id="creating-a-split-with-rsample" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-split-with-rsample">1.1 Creating a split with rsample</h2>
<p>Let’s use <code>initial_split()</code> from <code>rsample</code>, a package integrated in tidymodels, to create a train-test-validate split. To do so, split the data twice: First, create a simple train-test split, and then split the training data again into training and validation data.</p>
<details>
<summary>
<strong>Hint 1:</strong>
</summary>
<p>You can find an overview of functions within <code>rsample</code> on the <a href="https://rsample.tidymodels.org/reference/index.html">package website</a>.</p>
</details>
<details>
<summary>
<strong>Hint 2:</strong>
</summary>
<p>In principle, you will need three functions to create the necessary split objects: <code>initial_split()</code>, <code>training()</code>, and <code>testing()</code>.</p>
</details>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+dHJhaW52YWxfdGVzdF9zcGxpdCA8c3BhbiBjbGFzcz0ib3QiPiZsdDstPC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPmluaXRpYWxfc3BsaXQ8L3NwYW4+KGNlbGxzLCA8c3BhbiBjbGFzcz0iYXQiPnByb3AgPTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZsIj4wLjY8L3NwYW4+LCA8c3BhbiBjbGFzcz0iYXQiPnN0cmF0YSA9PC9zcGFuPiBjbGFzcyk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMiI+PGEgaHJlZj0iI2NiMS0yIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+Y2VsbHNfdHJhaW5fdmFsIDxzcGFuIGNsYXNzPSJvdCI+Jmx0Oy08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+dHJhaW5pbmc8L3NwYW4+KHRyYWludmFsX3Rlc3Rfc3BsaXQpPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTMiPjxhIGhyZWY9IiNjYjEtMyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPnRyYWluX3ZhbF9zcGxpdCA8c3BhbiBjbGFzcz0ib3QiPiZsdDstPC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPmluaXRpYWxfc3BsaXQ8L3NwYW4+KGNlbGxzX3RyYWluX3ZhbCwgPHNwYW4gY2xhc3M9ImF0Ij5wcm9wID08L3NwYW4+IDxzcGFuIGNsYXNzPSJmbCI+MC43PC9zcGFuPiwgPHNwYW4gY2xhc3M9ImF0Ij5zdHJhdGEgPTwvc3Bhbj4gY2xhc3MpPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTQiPjxhIGhyZWY9IiNjYjEtNCIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS01Ij48YSBocmVmPSIjY2IxLTUiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5jZWxsc190cmFpbiA8c3BhbiBjbGFzcz0ib3QiPiZsdDstPC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPnRyYWluaW5nPC9zcGFuPih0cmFpbl92YWxfc3BsaXQpPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTYiPjxhIGhyZWY9IiNjYjEtNiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPmNlbGxzX3ZhbCA8c3BhbiBjbGFzcz0ib3QiPiZsdDstPC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPnRlc3Rpbmc8L3NwYW4+KHRyYWluX3ZhbF9zcGxpdCk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtNyI+PGEgaHJlZj0iI2NiMS03IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+Y2VsbHNfdGVzdCA8c3BhbiBjbGFzcz0ib3QiPiZsdDstPC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPnRlc3Rpbmc8L3NwYW4+KHRyYWludmFsX3Rlc3Rfc3BsaXQpPC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPC9kaXY+"></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="training-a-naive-bayes-model" class="level2">
<h2 class="anchored" data-anchor-id="training-a-naive-bayes-model">1.2 Training a Naive Bayes model</h2>
<p>We’ll show the utility of calibration tools by using a type of model that, in this instance, is likely to produce a poorly calibrated model. The Naive Bayes classifier is a well-established model that assumes that the predictors are statistically <em>independent</em> of one another (to simplify the calculations). While that is certainly not the case for this data, the model can be effective at discriminating between the classes. Unfortunately, when there are many predictors in the model, it has a tendency to produce class probability distributions that are pathological. The predictions tend to gravitate to values near zero or one, producing distributions that are “U”-shaped (<a href="https://scholar.google.com/scholar?hl=en&amp;as_sdt=0%2C7&amp;q=%22Applied+Predictive+Modeling%22&amp;btnG=">Kuhn and Johnson, 2013</a>).</p>
<p>To demonstrate, let’s set up a Naive Bayes learner and train it using the training data.</p>
<details>
<summary>
<strong>Hint 1:</strong>
</summary>
<p>First, initialize a learner object. You can find a list of available learners <a href="https://www.tidymodels.org/find/parsnip/">here</a>.</p>
</details>
<details>
<summary>
<strong>Hint 2:</strong>
</summary>
<p>Once the learner object has been created, train the model using the <code>%&gt;%</code> pipe operator and the function <code>fit()</code>.</p>
</details>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5saWJyYXJ5PC9zcGFuPihrbGFSKTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0yIj48YSBocmVmPSIjY2IxLTIiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5sZWFybmVyIDxzcGFuIGNsYXNzPSJvdCI+Jmx0Oy08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+bmFpdmVfQmF5ZXM8L3NwYW4+KCk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMyI+PGEgaHJlZj0iI2NiMS0zIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+bmJfZml0IDxzcGFuIGNsYXNzPSJvdCI+Jmx0Oy08L3NwYW4+IGxlYXJuZXIgPHNwYW4gY2xhc3M9InNjIj4lJmd0OyU8L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+Zml0PC9zcGFuPihjbGFzcyA8c3BhbiBjbGFzcz0ic2MiPn48L3NwYW4+IC4sIDxzcGFuIGNsYXNzPSJhdCI+ZGF0YSA9PC9zcGFuPiBjZWxsc190cmFpbik8L3NwYW4+PC9jb2RlPjwvcHJlPjwvZGl2Pgo8L2Rpdj4="></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="predicting-on-unseen-test-data" class="level2">
<h2 class="anchored" data-anchor-id="predicting-on-unseen-test-data">1.3 Predicting on unseen test data</h2>
<p>Next, use the trained model to predict on unseen test data. In <code>tidymodels</code>, this will return two columns of predicted probabilities, one for <code>"PS"</code> and one for <code>"WS"</code>. Select for the predicted probabilities of class <code>"PS"</code> since for binary classification, we only need one column representing label probabilities to compute the model performance in the next step. You can do this by repeatedly using the <code>%&gt;%</code> pipe operator.</p>
<details>
<summary>
<strong>Hint 1:</strong>
</summary>
<p>You can use this code skeleton to produce the desired output:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>predictions_test <span class="ot">&lt;-</span> <span class="co"># the model # %&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># predict probabilities on test data # %&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.pred_PS) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(cells_test)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</details>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+cHJlZGljdGlvbnNfdGVzdCA8c3BhbiBjbGFzcz0ib3QiPiZsdDstPC9zcGFuPiBuYl9maXQgPHNwYW4gY2xhc3M9InNjIj4lJmd0OyU8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTIiPjxhIGhyZWY9IiNjYjEtMiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgPHNwYW4gY2xhc3M9ImZ1Ij5wcmVkaWN0PC9zcGFuPihjZWxsc190ZXN0LCA8c3BhbiBjbGFzcz0iYXQiPnR5cGUgPTwvc3Bhbj4gPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtwcm9iJnF1b3Q7PC9zcGFuPikgPHNwYW4gY2xhc3M9InNjIj4lJmd0OyU8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTMiPjxhIGhyZWY9IiNjYjEtMyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgPHNwYW4gY2xhc3M9ImZ1Ij5zZWxlY3Q8L3NwYW4+KC5wcmVkX1BTKSA8c3BhbiBjbGFzcz0ic2MiPiUmZ3Q7JTwvc3Bhbj48L3NwYW4+CjxzcGFuIGlkPSJjYjEtNCI+PGEgaHJlZj0iI2NiMS00IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICA8c3BhbiBjbGFzcz0iZnUiPmJpbmRfY29sczwvc3Bhbj4oY2VsbHNfdGVzdCk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtNSI+PGEgaHJlZj0iI2NiMS01IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTYiPjxhIGhyZWY9IiNjYjEtNiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjxzcGFuIGNsYXNzPSJmdSI+aGVhZDwvc3Bhbj4ocHJlZGljdGlvbnNfdGVzdClbPHNwYW4gY2xhc3M9ImR2Ij4xPC9zcGFuPjxzcGFuIGNsYXNzPSJzYyI+Ojwvc3Bhbj48c3BhbiBjbGFzcz0iZHYiPjU8L3NwYW4+XTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0IGNlbGwtb3V0cHV0LXN0ZG91dCI+CjxwcmU+PGNvZGU+IyBBIHRpYmJsZTogNiDDlyA1CiAgLnByZWRfUFMgY2xhc3MgYW5nbGVfY2hfMSBhcmVhX2NoXzEgYXZnX2ludGVuX2NoXzEKICAgICAmbHQ7ZGJsJmd0OyAmbHQ7ZmN0Jmd0OyAgICAgICZsdDtkYmwmZ3Q7ICAgICAmbHQ7aW50Jmd0OyAgICAgICAgICAmbHQ7ZGJsJmd0OwoxIDEuMDBlKyAwIFBTICAgICAgICAgMTM0LiAgICAgICAgODE5ICAgICAgICAgICAzMS45CjIgMS4wMGUrIDAgUFMgICAgICAgICAgNjkuMiAgICAgICAyOTggICAgICAgICAgIDE5LjUKMyA1Ljg0ZS0gOSBXUyAgICAgICAgIDE3NC4gICAgICAgIDE3NyAgICAgICAgICAyNjAuIAo0IDcuODhlLTEwIFdTICAgICAgICAgIDEzLjcgICAgICAgNDI0ICAgICAgICAgIDE3NC4gCjUgMS42MGUtMTAgV1MgICAgICAgICAgMjMuMSAgICAgICAzMTMgICAgICAgICAgMjE1LiAKNiAxLjAwZSsgMCBQUyAgICAgICAgICA5My42ICAgICAgIDc2MiAgICAgICAgICAgMzUuNjwvY29kZT48L3ByZT4KPC9kaXY+CjwvZGl2Pg=="></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="assessing-model-performance" class="level2">
<h2 class="anchored" data-anchor-id="assessing-model-performance">1.4 Assessing model performance</h2>
<p>We want to use two metrics from the <code>yardstick</code> package that comes with <code>tidymodels</code> to judge how well the model performs. First, the area under the ROC curve (ROC AUC) is used to measure the ability of the model to separate the classes (its mere ability to discriminate correctly). Second, the Brier score is used to measure how close the probability estimates are to the actual outcome values (its ability to express confidence in the label predictions). Compute the ROC AUC and the Brier Score on the test data predictions.</p>
<details>
<summary>
<strong>Hint 1:</strong>
</summary>
<p>Look at the <a href="https://yardstick.tidymodels.org/reference/index.html">functions available</a> in <code>yardstick</code> to find the desired metrics.</p>
</details>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5yb2NfYXVjPC9zcGFuPihwcmVkaWN0aW9uc190ZXN0LCA8c3BhbiBjbGFzcz0iYXQiPnRydXRoID08L3NwYW4+IGNsYXNzLCAucHJlZF9QUyk8L3NwYW4+PC9jb2RlPjwvcHJlPjwvZGl2Pgo8ZGl2IGNsYXNzPSJjZWxsLW91dHB1dCBjZWxsLW91dHB1dC1zdGRvdXQiPgo8cHJlPjxjb2RlPiMgQSB0aWJibGU6IDEgw5cgMwogIC5tZXRyaWMgLmVzdGltYXRvciAuZXN0aW1hdGUKICAmbHQ7Y2hyJmd0OyAgICZsdDtjaHImZ3Q7ICAgICAgICAgICZsdDtkYmwmZ3Q7CjEgcm9jX2F1YyBiaW5hcnkgICAgICAgICAwLjg1OTwvY29kZT48L3ByZT4KPC9kaXY+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjMiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjMtMSI+PGEgaHJlZj0iI2NiMy0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5icmllcl9jbGFzczwvc3Bhbj4ocHJlZGljdGlvbnNfdGVzdCwgY2xhc3MsIC5wcmVkX1BTKTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0IGNlbGwtb3V0cHV0LXN0ZG91dCI+CjxwcmU+PGNvZGU+IyBBIHRpYmJsZTogMSDDlyAzCiAgLm1ldHJpYyAgICAgLmVzdGltYXRvciAuZXN0aW1hdGUKICAmbHQ7Y2hyJmd0OyAgICAgICAmbHQ7Y2hyJmd0OyAgICAgICAgICAmbHQ7ZGJsJmd0OwoxIGJyaWVyX2NsYXNzIGJpbmFyeSAgICAgICAgIDAuMjA5PC9jb2RlPjwvcHJlPgo8L2Rpdj4KPC9kaXY+"></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="assessing-model-calibration" class="level2">
<h2 class="anchored" data-anchor-id="assessing-model-calibration">1.5 Assessing model calibration</h2>
<p>Let’s assess if our model is well-calibrated. Spoiler: it is not. The first clue is the extremely U-shaped distribution of the probability scores:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(predictions_test<span class="sc">$</span>.pred_PS, <span class="at">breaks =</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>)<span class="sc">/</span><span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are almost no cells with moderate probability estimates.</p>
<p>The <code>probably</code> package has tools for visualizing and correcting models with poor calibration properties.</p>
<p>The most common plot is to break the predictions into about ten equally sized buckets and compute the actual event rate within each. For example, if a bin captures the samples predicted to be poorly segmented with probabilities between 20% and 30%, we should expect about a 25% event rate (i.e., the bin midpoint) within that partition. Let’s do this with 10 and 5 bins using <code>cal_plot_breaks()</code> from the <code>probably</code> package.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+dW5jYWxpYnJhdGVkMTAgPHNwYW4gY2xhc3M9Im90Ij4mbHQ7LTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5jYWxfcGxvdF9icmVha3M8L3NwYW4+KHByZWRpY3Rpb25zX3Rlc3QsIDxzcGFuIGNsYXNzPSJhdCI+dHJ1dGggPTwvc3Bhbj4gY2xhc3MsIDxzcGFuIGNsYXNzPSJhdCI+bnVtX2JyZWFrcyA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iZHYiPjEwPC9zcGFuPikgPHNwYW4gY2xhc3M9InNjIj4rPC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPmdndGl0bGU8L3NwYW4+KDxzcGFuIGNsYXNzPSJzdCI+JnF1b3Q7VW5jYWxpYnJhdGVkIC0gMTAgYmlucyZxdW90Ozwvc3Bhbj4pPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTIiPjxhIGhyZWY9IiNjYjEtMiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPnVuY2FsaWJyYXRlZDUgPHNwYW4gY2xhc3M9Im90Ij4mbHQ7LTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5jYWxfcGxvdF9icmVha3M8L3NwYW4+KHByZWRpY3Rpb25zX3Rlc3QsIDxzcGFuIGNsYXNzPSJhdCI+dHJ1dGggPTwvc3Bhbj4gY2xhc3MsIDxzcGFuIGNsYXNzPSJhdCI+bnVtX2JyZWFrcyA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iZHYiPjU8L3NwYW4+KSA8c3BhbiBjbGFzcz0ic2MiPis8L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+Z2d0aXRsZTwvc3Bhbj4oPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtVbmNhbGlicmF0ZWQgLSA1IGJpbnMmcXVvdDs8L3NwYW4+KTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0zIj48YSBocmVmPSIjY2IxLTMiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT48c3BhbiBjbGFzcz0iZnUiPmdyaWQuYXJyYW5nZTwvc3Bhbj4odW5jYWxpYnJhdGVkMTAsIHVuY2FsaWJyYXRlZDUsIDxzcGFuIGNsYXNzPSJhdCI+bmNvbCA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iZHYiPjI8L3NwYW4+KTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0LWRpc3BsYXkiPgo8cD48aW1nIHNyYz0iaW5kZXhfZmlsZXMvZmlndXJlLWh0bWwvdW5uYW1lZC1jaHVuay0xMi0xLnBuZyIKZGF0YS1maWctYWxpZ249ImNlbnRlciIgd2lkdGg9IjY3MiIgLz48L3A+CjwvZGl2Pgo8L2Rpdj4="></div></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="platt-scaling" class="level1">
<h1>2 Platt scaling</h1>
<p>The good news is that we can do something about this. There are tools to “fix” the probability estimates so that they have better properties, such as falling along the diagonal lines in the diagnostic plots shown above. Different methods improve the predictions in different ways.</p>
<p>The most common approach is Platt scaling, also called logistic calibration. This works in the following way: The original model is used to predict on the validation data set, returning predicted probabilities. We already know these probabilities are off, i.e., not well-calibrated. Then, we fit a simple logistic regression model, using the predicted probabilities from the original model as “x/feature” and the true labels as “y/target”. In this way, we stack a second model on top of the first one: Original Model -&gt; Probabilities -&gt; Logistic Regression Model -&gt; Calibrated Probabilities.</p>
<p>If effective, the logistic regression model estimates the probability regions where the original model is off (as shown in the diagnostic plot). For example, suppose that when the model predicts a 2% event rate, the logistic regression model estimates that it under-predicts the probability by 5% (relative to the observed data). Given this gap, new predictions are adjusted up so that the probability estimates are more in-line with the data.</p>
<section id="platt-scaling-with-base-r" class="level2">
<h2 class="anchored" data-anchor-id="platt-scaling-with-base-r">2.1 Platt scaling with {base R}</h2>
</section>
<section id="task" class="level2">
<h2 class="anchored" data-anchor-id="task">2.1.1 Task</h2>
<p>Let’s do this with base R. First, we need predictions of the model on the validation data:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create predictions on the validation set</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>predictions_val <span class="ot">&lt;-</span> nb_fit <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(cells_val, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.pred_PS) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(cells_val)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Also, we transform the class variable (a factor) to binary (0-1) format:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>predictions_val<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">as.numeric</span>(predictions_val<span class="sc">$</span>class) <span class="sc">-</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now, fit a logistic regression with y as the true label of the validation data and x as the predictions of the uncalibrated model on the validation data.</p>
<details>
<summary>
<strong>Hint 1:</strong>
</summary>
<p>As we want to fit a logistic regression model, you can use <code>glm()</code>.</p>
</details>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+Y2FsaWJyYXRvcl9sb2dyZWcgPHNwYW4gY2xhc3M9Im90Ij4mbHQ7LTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5nbG08L3NwYW4+KGNsYXNzIDxzcGFuIGNsYXNzPSJzYyI+fjwvc3Bhbj4gLnByZWRfUFMsIDxzcGFuIGNsYXNzPSJhdCI+ZmFtaWx5ID08L3NwYW4+IGJpbm9taWFsLCA8c3BhbiBjbGFzcz0iYXQiPmRhdGEgPTwvc3Bhbj4gcHJlZGljdGlvbnNfdmFsKTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjwvZGl2Pg=="></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">2.1.2 Discussion</h2>
<p>How do we know if this works? As we used training data to fit the Naive Bayes model and validation data to fit the logistic regression model, we need to use testing data to assess the performance of the combined (and hopefully well-calibrated) model:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use logistic calibration model to adjust predictions on test data</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>predictions_test_calibrated <span class="ot">&lt;-</span> predictions_test</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>predictions_test_calibrated<span class="sc">$</span>.pred_PS <span class="ot">&lt;-</span> <span class="fu">predict</span>(calibrator_logreg, <span class="at">newdata =</span> predictions_test_calibrated, <span class="at">type =</span> <span class="st">"response"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>How well-calibrated is this model? Assess the model performance by checking the ROC AUC and the Brier score of the calibrated model and the model calibration by looking at the histogram of predicted probabilities and by comparing calibration plots of the calibrated model to the uncalibrated model (as in exercises 4 and 5).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5yb2NfYXVjPC9zcGFuPihwcmVkaWN0aW9uc190ZXN0X2NhbGlicmF0ZWQsIDxzcGFuIGNsYXNzPSJhdCI+dHJ1dGggPTwvc3Bhbj4gY2xhc3MsIC5wcmVkX1BTKTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0IGNlbGwtb3V0cHV0LXN0ZG91dCI+CjxwcmU+PGNvZGU+IyBBIHRpYmJsZTogMSDDlyAzCiAgLm1ldHJpYyAuZXN0aW1hdG9yIC5lc3RpbWF0ZQogICZsdDtjaHImZ3Q7ICAgJmx0O2NociZndDsgICAgICAgICAgJmx0O2RibCZndDsKMSByb2NfYXVjIGJpbmFyeSAgICAgICAgIDAuODU5PC9jb2RlPjwvcHJlPgo8L2Rpdj4KPGRpdiBjbGFzcz0ic291cmNlQ29kZSIgaWQ9ImNiMyI+PHByZQpjbGFzcz0ic291cmNlQ29kZSByIGNlbGwtY29kZSI+PGNvZGUgY2xhc3M9InNvdXJjZUNvZGUgciI+PHNwYW4gaWQ9ImNiMy0xIj48YSBocmVmPSIjY2IzLTEiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT48c3BhbiBjbGFzcz0iZnUiPmJyaWVyX2NsYXNzPC9zcGFuPihwcmVkaWN0aW9uc190ZXN0X2NhbGlicmF0ZWQsIGNsYXNzLCAucHJlZF9QUyk8L3NwYW4+PC9jb2RlPjwvcHJlPjwvZGl2Pgo8ZGl2IGNsYXNzPSJjZWxsLW91dHB1dCBjZWxsLW91dHB1dC1zdGRvdXQiPgo8cHJlPjxjb2RlPiMgQSB0aWJibGU6IDEgw5cgMwogIC5tZXRyaWMgICAgIC5lc3RpbWF0b3IgLmVzdGltYXRlCiAgJmx0O2NociZndDsgICAgICAgJmx0O2NociZndDsgICAgICAgICAgJmx0O2RibCZndDsKMSBicmllcl9jbGFzcyBiaW5hcnkgICAgICAgICAwLjE1OTwvY29kZT48L3ByZT4KPC9kaXY+CjwvZGl2Pgo8cD5XZSBjYW4gc2VlIGEgc2xpZ2h0IGltcHJvdmVtZW50OiBUaGUgYnJpZXIgc2NvcmUgYXMgZXZhbHVhdGVkIG9uIHRoZQp0ZXN0IGRhdGEgaW1wcm92ZWQuIEludGVyZXN0aW5nbHksIHRoZSBST0MgQVVDIHJlbWFpbnMgdW5hZmZlY3RlZC4gVGhpcwpzaG91bGQgYmUgbm8gc3VycHJpc2UsIGhvd2V2ZXIsIGFzIHRoZSBST0MgQVVDIGFzc2Vzc2VzIGEgbW9kZWzigJlzCmFiaWxpdHkgdG8gZGlzY3JpbWluYXRlIGJldHdlZW4gY2xhc3Nlcy4gSWYgd2Ugc2ltcGx5IHNxdWFzaCB0aGUKcHJvYmFiaWxpdGllcyB1c2luZyB0aGUgbG9naXN0aWMgZnVuY3Rpb24sIHRoaXMgd2lsbCBsaWtlbHkgbm90IGNoYW5nZQp0aGUgcHJlZGljdGVkIGxhYmVscyB0b28gbXVjaC48L3A+CjxwPkxldOKAmXMgY2hlY2sgdGhlIGhpc3RvZ3JhbSBvZiBwcmVkaWN0ZWQgcHJvYmFiaWxpdGllcyBhbmQgY29tcGFyZQpjYWxpYnJhdGlvbiBwbG90cyBvZiB0aGUgY2FsaWJyYXRlZCBtb2RlbCB0byB0aGUgdW5jYWxpYnJhdGVkIG1vZGVsLjwvcD4KPGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjUiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjUtMSI+PGEgaHJlZj0iI2NiNS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5oaXN0PC9zcGFuPihwcmVkaWN0aW9uc190ZXN0X2NhbGlicmF0ZWQ8c3BhbiBjbGFzcz0ic2MiPiQ8L3NwYW4+LnByZWRfUFMsIDxzcGFuIGNsYXNzPSJhdCI+YnJlYWtzID08L3NwYW4+ICg8c3BhbiBjbGFzcz0iZHYiPjA8L3NwYW4+PHNwYW4gY2xhc3M9InNjIj46PC9zcGFuPjxzcGFuIGNsYXNzPSJkdiI+MTA8L3NwYW4+KTxzcGFuIGNsYXNzPSJzYyI+Lzwvc3Bhbj48c3BhbiBjbGFzcz0iZHYiPjEwPC9zcGFuPik8L3NwYW4+PC9jb2RlPjwvcHJlPjwvZGl2Pgo8ZGl2IGNsYXNzPSJjZWxsLW91dHB1dC1kaXNwbGF5Ij4KPHA+PGltZyBzcmM9ImluZGV4X2ZpbGVzL2ZpZ3VyZS1odG1sL3VubmFtZWQtY2h1bmstMTgtMS5wbmciCmRhdGEtZmlnLWFsaWduPSJjZW50ZXIiIHdpZHRoPSI2NzIiIC8+PC9wPgo8L2Rpdj4KPGRpdiBjbGFzcz0ic291cmNlQ29kZSIgaWQ9ImNiNiI+PHByZQpjbGFzcz0ic291cmNlQ29kZSByIGNlbGwtY29kZSI+PGNvZGUgY2xhc3M9InNvdXJjZUNvZGUgciI+PHNwYW4gaWQ9ImNiNi0xIj48YSBocmVmPSIjY2I2LTEiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5sb2dfY2FsaWJyYXRlZDEwIDxzcGFuIGNsYXNzPSJvdCI+Jmx0Oy08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+Y2FsX3Bsb3RfYnJlYWtzPC9zcGFuPihwcmVkaWN0aW9uc190ZXN0X2NhbGlicmF0ZWQsIDxzcGFuIGNsYXNzPSJhdCI+dHJ1dGggPTwvc3Bhbj4gY2xhc3MsIDxzcGFuIGNsYXNzPSJhdCI+bnVtX2JyZWFrcyA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iZHYiPjEwPC9zcGFuPikgPHNwYW4gY2xhc3M9InNjIj4rPC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPmdndGl0bGU8L3NwYW4+KDxzcGFuIGNsYXNzPSJzdCI+JnF1b3Q7TG9nLWNhbGlicmF0ZWQgLSAxMCBiaW5zJnF1b3Q7PC9zcGFuPik8L3NwYW4+CjxzcGFuIGlkPSJjYjYtMiI+PGEgaHJlZj0iI2NiNi0yIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+bG9nX2NhbGlicmF0ZWQ1IDxzcGFuIGNsYXNzPSJvdCI+Jmx0Oy08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+Y2FsX3Bsb3RfYnJlYWtzPC9zcGFuPihwcmVkaWN0aW9uc190ZXN0X2NhbGlicmF0ZWQsIDxzcGFuIGNsYXNzPSJhdCI+dHJ1dGggPTwvc3Bhbj4gY2xhc3MsIDxzcGFuIGNsYXNzPSJhdCI+bnVtX2JyZWFrcyA9PC9zcGFuPiA8c3BhbiBjbGFzcz0iZHYiPjU8L3NwYW4+KSA8c3BhbiBjbGFzcz0ic2MiPis8L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+Z2d0aXRsZTwvc3Bhbj4oPHNwYW4gY2xhc3M9InN0Ij4mcXVvdDtMb2ctY2FsaWJyYXRlZCAtIDUgYmlucyZxdW90Ozwvc3Bhbj4pPC9zcGFuPgo8c3BhbiBpZD0iY2I2LTMiPjxhIGhyZWY9IiNjYjYtMyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjxzcGFuIGNsYXNzPSJmdSI+Z3JpZC5hcnJhbmdlPC9zcGFuPih1bmNhbGlicmF0ZWQxMCwgbG9nX2NhbGlicmF0ZWQxMCwgPHNwYW4gY2xhc3M9ImF0Ij5uY29sID08L3NwYW4+IDxzcGFuIGNsYXNzPSJkdiI+Mjwvc3Bhbj4pPC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPGRpdiBjbGFzcz0iY2VsbC1vdXRwdXQtZGlzcGxheSI+CjxwPjxpbWcgc3JjPSJpbmRleF9maWxlcy9maWd1cmUtaHRtbC91bm5hbWVkLWNodW5rLTE4LTIucG5nIgpkYXRhLWZpZy1hbGlnbj0iY2VudGVyIiB3aWR0aD0iNjcyIiAvPjwvcD4KPC9kaXY+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjciPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjctMSI+PGEgaHJlZj0iI2NiNy0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5ncmlkLmFycmFuZ2U8L3NwYW4+KHVuY2FsaWJyYXRlZDUsIGxvZ19jYWxpYnJhdGVkNSwgPHNwYW4gY2xhc3M9ImF0Ij5uY29sID08L3NwYW4+IDxzcGFuIGNsYXNzPSJkdiI+Mjwvc3Bhbj4pPC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPGRpdiBjbGFzcz0iY2VsbC1vdXRwdXQtZGlzcGxheSI+CjxwPjxpbWcgc3JjPSJpbmRleF9maWxlcy9maWd1cmUtaHRtbC91bm5hbWVkLWNodW5rLTE4LTMucG5nIgpkYXRhLWZpZy1hbGlnbj0iY2VudGVyIiB3aWR0aD0iNjcyIiAvPjwvcD4KPC9kaXY+CjwvZGl2Pgo8cD5BbiBpbXByb3ZlbWVudCBjYW4gYWxzbyBiZSBvYnNlcnZlZCBoZXJlLCBhcyB0aGUgY2FsaWJyYXRpb24gZGlhZ3JhbXMKb2YgdGhlIGNhbGlicmF0ZWQgbW9kZWwgYXJlIGNsb3NlciB0byB0aGUgZGlhZ29uYWwgdGhhbiB0aG9zZSBvZiB0aGUKdW5jYWxpYnJhdGVkIG1vZGVsLjwvcD4="></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="platt-scaling-with-probably" class="level2">
<h2 class="anchored" data-anchor-id="platt-scaling-with-probably">2.2 Platt scaling with {probably}</h2>
</section>
<section id="task-1" class="level2">
<h2 class="anchored" data-anchor-id="task-1">2.2.1 Task</h2>
<p>Now, apply Platt scaling using <code>cal_*</code> functions from <code>probably</code>.</p>
<details>
<summary>
<strong>Hint 1:</strong>
</summary>
<p>You can use the code skeleton below:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions on the validation set (again because probably wants a factor as target)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>predictions_val <span class="ot">&lt;-</span> nb_fit <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(cells_val, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(cells_val)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calibrate the model using validation data</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="do">## -&gt; your code here &lt;- ##</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict with original model on test data</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>predictions_test <span class="ot">&lt;-</span> nb_fit <span class="sc">%&gt;%</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(cells_test, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(cells_test)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply calibration model on original model predictions</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="do">## -&gt; your code here &lt;- ##</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</details>
<details>
<summary>
<strong>Hint 2:</strong>
</summary>
<p>Take a look at the <a href="https://probably.tidymodels.org/reference/index.html#calibration">function reference</a>. You will need one function to compute the calibration model, and another function to recompute the model probabilities. As a sanity check, we should score the same metrics as when using base R.</p>
</details>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImNvIj4jIE1ha2UgcHJlZGljdGlvbnMgb24gdGhlIHZhbGlkYXRpb24gc2V0IChhZ2FpbiBiZWNhdXNlIHByb2JhYmx5IHdhbnRzIGEgZmFjdG9yIGFzIHRhcmdldCk8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTIiPjxhIGhyZWY9IiNjYjEtMiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPnByZWRpY3Rpb25zX3ZhbCA8c3BhbiBjbGFzcz0ib3QiPiZsdDstPC9zcGFuPiBuYl9maXQgPHNwYW4gY2xhc3M9InNjIj4lJmd0OyU8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTMiPjxhIGhyZWY9IiNjYjEtMyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgPHNwYW4gY2xhc3M9ImZ1Ij5wcmVkaWN0PC9zcGFuPihjZWxsc192YWwsIDxzcGFuIGNsYXNzPSJhdCI+dHlwZSA9PC9zcGFuPiA8c3BhbiBjbGFzcz0ic3QiPiZxdW90O3Byb2ImcXVvdDs8L3NwYW4+KSA8c3BhbiBjbGFzcz0ic2MiPiUmZ3Q7JTwvc3Bhbj48L3NwYW4+CjxzcGFuIGlkPSJjYjEtNCI+PGEgaHJlZj0iI2NiMS00IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICA8c3BhbiBjbGFzcz0iZnUiPmJpbmRfY29sczwvc3Bhbj4oY2VsbHNfdmFsKTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS01Ij48YSBocmVmPSIjY2IxLTUiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT48L3NwYW4+CjxzcGFuIGlkPSJjYjEtNiI+PGEgaHJlZj0iI2NiMS02IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImNvIj4jIENhbGlicmF0ZSB0aGUgbW9kZWwgdXNpbmcgdmFsaWRhdGlvbiBkYXRhPC9zcGFuPjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS03Ij48YSBocmVmPSIjY2IxLTciIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5jYWxpYnJhdG9yX2xvZ3JlZ19hbHQgPHNwYW4gY2xhc3M9Im90Ij49PC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPmNhbF9lc3RpbWF0ZV9sb2dpc3RpYzwvc3Bhbj4ocHJlZGljdGlvbnNfdmFsLCA8c3BhbiBjbGFzcz0iYXQiPnRydXRoID08L3NwYW4+IGNsYXNzKTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS04Ij48YSBocmVmPSIjY2IxLTgiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT48L3NwYW4+CjxzcGFuIGlkPSJjYjEtOSI+PGEgaHJlZj0iI2NiMS05IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImNvIj4jIFByZWRpY3Qgd2l0aCBvcmlnaW5hbCBtb2RlbCBvbiB0ZXN0IGRhdGE8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTEwIj48YSBocmVmPSIjY2IxLTEwIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+cHJlZGljdGlvbnNfdGVzdCA8c3BhbiBjbGFzcz0ib3QiPiZsdDstPC9zcGFuPiBuYl9maXQgPHNwYW4gY2xhc3M9InNjIj4lJmd0OyU8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTExIj48YSBocmVmPSIjY2IxLTExIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICA8c3BhbiBjbGFzcz0iZnUiPnByZWRpY3Q8L3NwYW4+KGNlbGxzX3Rlc3QsIDxzcGFuIGNsYXNzPSJhdCI+dHlwZSA9PC9zcGFuPiA8c3BhbiBjbGFzcz0ic3QiPiZxdW90O3Byb2ImcXVvdDs8L3NwYW4+KSA8c3BhbiBjbGFzcz0ic2MiPiUmZ3Q7JTwvc3Bhbj48L3NwYW4+CjxzcGFuIGlkPSJjYjEtMTIiPjxhIGhyZWY9IiNjYjEtMTIiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4gIDxzcGFuIGNsYXNzPSJmdSI+YmluZF9jb2xzPC9zcGFuPihjZWxsc190ZXN0KTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0xMyI+PGEgaHJlZj0iI2NiMS0xMyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0xNCI+PGEgaHJlZj0iI2NiMS0xNCIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjxzcGFuIGNsYXNzPSJjbyI+IyBBcHBseSBjYWxpYnJhdGlvbiBtb2RlbCBvbiBvcmlnaW5hbCBtb2RlbCBwcmVkaWN0aW9uczwvc3Bhbj48L3NwYW4+CjxzcGFuIGlkPSJjYjEtMTUiPjxhIGhyZWY9IiNjYjEtMTUiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5wcmVkaWN0aW9uc190ZXN0X2NhbGlicmF0ZWRfYWx0IDxzcGFuIGNsYXNzPSJvdCI+Jmx0Oy08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+Y2FsX2FwcGx5PC9zcGFuPihwcmVkaWN0aW9uc190ZXN0LCBjYWxpYnJhdG9yX2xvZ3JlZ19hbHQpPC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPC9kaXY+"></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="discussion-1" class="level2">
<h2 class="anchored" data-anchor-id="discussion-1">2.2.2 Discussion</h2>
<p>Let’s check if the metrics for the approach using <code>probably</code> match with the results we got using base R.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImNvIj4jIFNhbml0eSBjaGVjazo8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTIiPjxhIGhyZWY9IiNjYjEtMiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjxzcGFuIGNsYXNzPSJmdSI+cm9jX2F1Yzwvc3Bhbj4ocHJlZGljdGlvbnNfdGVzdF9jYWxpYnJhdGVkX2FsdCwgPHNwYW4gY2xhc3M9ImF0Ij50cnV0aCA9PC9zcGFuPiBjbGFzcywgLnByZWRfUFMpPC9zcGFuPjwvY29kZT48L3ByZT48L2Rpdj4KPGRpdiBjbGFzcz0iY2VsbC1vdXRwdXQgY2VsbC1vdXRwdXQtc3Rkb3V0Ij4KPHByZT48Y29kZT4jIEEgdGliYmxlOiAxIMOXIDMKICAubWV0cmljIC5lc3RpbWF0b3IgLmVzdGltYXRlCiAgJmx0O2NociZndDsgICAmbHQ7Y2hyJmd0OyAgICAgICAgICAmbHQ7ZGJsJmd0OwoxIHJvY19hdWMgYmluYXJ5ICAgICAgICAgMC44NTk8L2NvZGU+PC9wcmU+CjwvZGl2Pgo8ZGl2IGNsYXNzPSJzb3VyY2VDb2RlIiBpZD0iY2IzIj48cHJlCmNsYXNzPSJzb3VyY2VDb2RlIHIgY2VsbC1jb2RlIj48Y29kZSBjbGFzcz0ic291cmNlQ29kZSByIj48c3BhbiBpZD0iY2IzLTEiPjxhIGhyZWY9IiNjYjMtMSIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjxzcGFuIGNsYXNzPSJmdSI+YnJpZXJfY2xhc3M8L3NwYW4+KHByZWRpY3Rpb25zX3Rlc3RfY2FsaWJyYXRlZF9hbHQsIGNsYXNzLCAucHJlZF9QUyk8L3NwYW4+PC9jb2RlPjwvcHJlPjwvZGl2Pgo8ZGl2IGNsYXNzPSJjZWxsLW91dHB1dCBjZWxsLW91dHB1dC1zdGRvdXQiPgo8cHJlPjxjb2RlPiMgQSB0aWJibGU6IDEgw5cgMwogIC5tZXRyaWMgICAgIC5lc3RpbWF0b3IgLmVzdGltYXRlCiAgJmx0O2NociZndDsgICAgICAgJmx0O2NociZndDsgICAgICAgICAgJmx0O2RibCZndDsKMSBicmllcl9jbGFzcyBiaW5hcnkgICAgICAgICAwLjE1OTwvY29kZT48L3ByZT4KPC9kaXY+CjwvZGl2Pgo8cD5JbmRlZWQsIGJvdGggYXBwcm9hY2hlcyB5aWVsZCB0aGUgc2FtZSByZXN1bHRzLjwvcD4="></div></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="isotonic-regression" class="level1">
<h1>3 Isotonic regression</h1>
<p>A different approach to calibration is to use isotonic regression. In a manner similar to logistic calibration, use <code>probably</code> to calibrate the Naive Bayes model using isotonic regression. Do we improve the calibration in comparison to Platt scaling?</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PHA+Tm8sIGl0IHNlZW1zIGxpa2UgaXNvdG9uaWMgcmVncmVzc2lvbiBjYW4gYWNoaWV2ZSBzaW1pbGFyIGNhbGlicmF0aW9uCnBlcmZvcm1hbmNlIGhlcmUsIGJ1dCBub3QgaW1wcm92ZSBmdXJ0aGVyIHRoYW4gd2hhdCBQbGF0dCBzY2FsaW5nIGhhcwphY2hpZXZlZDo8L3A+CjxkaXYgY2xhc3M9ImNlbGwiIGRhdGEtbGF5b3V0LWFsaWduPSJjZW50ZXIiPgo8ZGl2IGNsYXNzPSJzb3VyY2VDb2RlIiBpZD0iY2IxIj48cHJlCmNsYXNzPSJzb3VyY2VDb2RlIHIgY2VsbC1jb2RlIj48Y29kZSBjbGFzcz0ic291cmNlQ29kZSByIj48c3BhbiBpZD0iY2IxLTEiPjxhIGhyZWY9IiNjYjEtMSIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjxzcGFuIGNsYXNzPSJjbyI+IyBDYWxpYnJhdGUgdGhlIG1vZGVsIHVzaW5nIHZhbGlkYXRpb24gZGF0YTwvc3Bhbj48L3NwYW4+CjxzcGFuIGlkPSJjYjEtMiI+PGEgaHJlZj0iI2NiMS0yIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+Y2FsaWJyYXRvcl9pc28gPHNwYW4gY2xhc3M9Im90Ij49PC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPmNhbF9lc3RpbWF0ZV9pc290b25pYzwvc3Bhbj4ocHJlZGljdGlvbnNfdmFsLCA8c3BhbiBjbGFzcz0iYXQiPnRydXRoID08L3NwYW4+IGNsYXNzKTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0zIj48YSBocmVmPSIjY2IxLTMiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT48L3NwYW4+CjxzcGFuIGlkPSJjYjEtNCI+PGEgaHJlZj0iI2NiMS00IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImNvIj4jIEFwcGx5IGNhbGlicmF0aW9uIG1vZGVsIG9uIG9yaWdpbmFsIG1vZGVsIHByZWRpY3Rpb25zPC9zcGFuPjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS01Ij48YSBocmVmPSIjY2IxLTUiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5wcmVkaWN0aW9uc190ZXN0X2NhbGlicmF0ZWRfaXNvIDxzcGFuIGNsYXNzPSJvdCI+Jmx0Oy08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+Y2FsX2FwcGx5PC9zcGFuPihwcmVkaWN0aW9uc190ZXN0LCBjYWxpYnJhdG9yX2lzbyk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtNiI+PGEgaHJlZj0iI2NiMS02IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTciPjxhIGhyZWY9IiNjYjEtNyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjxzcGFuIGNsYXNzPSJjbyI+IyBEbyB3ZSBpbXByb3ZlPzwvc3Bhbj48L3NwYW4+CjxzcGFuIGlkPSJjYjEtOCI+PGEgaHJlZj0iI2NiMS04IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5yb2NfYXVjPC9zcGFuPihwcmVkaWN0aW9uc190ZXN0X2NhbGlicmF0ZWRfaXNvLCA8c3BhbiBjbGFzcz0iYXQiPnRydXRoID08L3NwYW4+IGNsYXNzLCAucHJlZF9QUyk8L3NwYW4+PC9jb2RlPjwvcHJlPjwvZGl2Pgo8ZGl2IGNsYXNzPSJjZWxsLW91dHB1dCBjZWxsLW91dHB1dC1zdGRvdXQiPgo8cHJlPjxjb2RlPiMgQSB0aWJibGU6IDEgw5cgMwogIC5tZXRyaWMgLmVzdGltYXRvciAuZXN0aW1hdGUKICAmbHQ7Y2hyJmd0OyAgICZsdDtjaHImZ3Q7ICAgICAgICAgICZsdDtkYmwmZ3Q7CjEgcm9jX2F1YyBiaW5hcnkgICAgICAgICAwLjg1NzwvY29kZT48L3ByZT4KPC9kaXY+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjMiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjMtMSI+PGEgaHJlZj0iI2NiMy0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5icmllcl9jbGFzczwvc3Bhbj4ocHJlZGljdGlvbnNfdGVzdF9jYWxpYnJhdGVkX2lzbywgY2xhc3MsIC5wcmVkX1BTKTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0IGNlbGwtb3V0cHV0LXN0ZG91dCI+CjxwcmU+PGNvZGU+IyBBIHRpYmJsZTogMSDDlyAzCiAgLm1ldHJpYyAgICAgLmVzdGltYXRvciAuZXN0aW1hdGUKICAmbHQ7Y2hyJmd0OyAgICAgICAmbHQ7Y2hyJmd0OyAgICAgICAgICAmbHQ7ZGJsJmd0OwoxIGJyaWVyX2NsYXNzIGJpbmFyeSAgICAgICAgIDAuMTY0PC9jb2RlPjwvcHJlPgo8L2Rpdj4KPGRpdiBjbGFzcz0ic291cmNlQ29kZSIgaWQ9ImNiNSI+PHByZQpjbGFzcz0ic291cmNlQ29kZSByIGNlbGwtY29kZSI+PGNvZGUgY2xhc3M9InNvdXJjZUNvZGUgciI+PHNwYW4gaWQ9ImNiNS0xIj48YSBocmVmPSIjY2I1LTEiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5pc29fY2FsaWJyYXRlZDEwIDxzcGFuIGNsYXNzPSJvdCI+Jmx0Oy08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+Y2FsX3Bsb3RfYnJlYWtzPC9zcGFuPihwcmVkaWN0aW9uc190ZXN0X2NhbGlicmF0ZWRfaXNvLCA8c3BhbiBjbGFzcz0iYXQiPnRydXRoID08L3NwYW4+IGNsYXNzLCA8c3BhbiBjbGFzcz0iYXQiPm51bV9icmVha3MgPTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImR2Ij4xMDwvc3Bhbj4pIDxzcGFuIGNsYXNzPSJzYyI+Kzwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5nZ3RpdGxlPC9zcGFuPig8c3BhbiBjbGFzcz0ic3QiPiZxdW90O0lzby1jYWxpYnJhdGVkIC0gMTAgYmlucyZxdW90Ozwvc3Bhbj4pPC9zcGFuPgo8c3BhbiBpZD0iY2I1LTIiPjxhIGhyZWY9IiNjYjUtMiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPmlzb19jYWxpYnJhdGVkNSA8c3BhbiBjbGFzcz0ib3QiPiZsdDstPC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPmNhbF9wbG90X2JyZWFrczwvc3Bhbj4ocHJlZGljdGlvbnNfdGVzdF9jYWxpYnJhdGVkX2lzbywgPHNwYW4gY2xhc3M9ImF0Ij50cnV0aCA9PC9zcGFuPiBjbGFzcywgPHNwYW4gY2xhc3M9ImF0Ij5udW1fYnJlYWtzID08L3NwYW4+IDxzcGFuIGNsYXNzPSJkdiI+NTwvc3Bhbj4pIDxzcGFuIGNsYXNzPSJzYyI+Kzwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5nZ3RpdGxlPC9zcGFuPig8c3BhbiBjbGFzcz0ic3QiPiZxdW90O0lzby1jYWxpYnJhdGVkIC0gNSBiaW5zJnF1b3Q7PC9zcGFuPik8L3NwYW4+CjxzcGFuIGlkPSJjYjUtMyI+PGEgaHJlZj0iI2NiNS0zIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5ncmlkLmFycmFuZ2U8L3NwYW4+KGxvZ19jYWxpYnJhdGVkMTAsIGlzb19jYWxpYnJhdGVkMTAsIGxvZ19jYWxpYnJhdGVkNSwgaXNvX2NhbGlicmF0ZWQ1LCA8c3BhbiBjbGFzcz0iYXQiPm5jb2wgPTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImR2Ij4yPC9zcGFuPik8L3NwYW4+PC9jb2RlPjwvcHJlPjwvZGl2Pgo8ZGl2IGNsYXNzPSJjZWxsLW91dHB1dC1kaXNwbGF5Ij4KPHA+PGltZyBzcmM9ImluZGV4X2ZpbGVzL2ZpZ3VyZS1odG1sL3VubmFtZWQtY2h1bmstMjItMS5wbmciCmRhdGEtZmlnLWFsaWduPSJjZW50ZXIiIHdpZHRoPSI2NzIiIC8+PC9wPgo8L2Rpdj4KPC9kaXY+"></div></div>
</div>
</div>
</div>
</div>
</section>
<section id="resamping-for-calibration-with-probably" class="level1">
<h1>4 Resamping for Calibration with probably</h1>
<p>The advantage of using <code>probably</code> for calibration is that one can easily access different calibration methods within a unified framework. In the examples above, we have used a simple train-validate-test split to perform calibration and evaluate the resulting models. In practice, we would prefer to use resampling, e.g.&nbsp;as in cross-validation (CV), to assess calibration methods. This can also be done with <code>probably</code>. In fact, we can use the <code>cal_validate_*()</code> function family to calibrate models contained in <code>resample_results</code> objects created with <code>tidymodels</code>. Fit 10 Naive Bayes models using 10-fold CV and calibrate each of these models using beta calibration, another calibration method.</p>
<details>
<summary>
<strong>Hint 1:</strong>
</summary>
<p>You can use the following code skeleton, detailing the required steps:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create CV specification</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>cells_cv <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(...)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify metrics</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>metr <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(...)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Save predictions</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Model workflow</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>bayes_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(class <span class="sc">~</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(<span class="fu">naive_Bayes</span>())</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit resamples</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>bayes_res <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(...)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calibrate each of the models</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>beta_val <span class="ot">&lt;-</span> <span class="fu">cal_validate_beta</span>(...)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate calibrated models</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(beta_val)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</details>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="b64-wrapper"><button class="unlock-btn" onclick="unlockOne(this)">Unlock solution</button><div class="hidden-solution" style="display:none" data-encoded="PGRpdiBjbGFzcz0iY2VsbCIgZGF0YS1sYXlvdXQtYWxpZ249ImNlbnRlciI+CjxkaXYgY2xhc3M9InNvdXJjZUNvZGUiIGlkPSJjYjEiPjxwcmUKY2xhc3M9InNvdXJjZUNvZGUgciBjZWxsLWNvZGUiPjxjb2RlIGNsYXNzPSJzb3VyY2VDb2RlIHIiPjxzcGFuIGlkPSJjYjEtMSI+PGEgaHJlZj0iI2NiMS0xIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImNvIj4jIENyZWF0ZSBDViBzcGVjaWZpY2F0aW9uPC9zcGFuPjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0yIj48YSBocmVmPSIjY2IxLTIiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5jZWxsc19jdiA8c3BhbiBjbGFzcz0ib3QiPiZsdDstPC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPnZmb2xkX2N2PC9zcGFuPihjZWxscywgPHNwYW4gY2xhc3M9ImF0Ij5zdHJhdGEgPTwvc3Bhbj4gY2xhc3MpIDxzcGFuIGNsYXNzPSJjbyI+IyAxMCBmb2xkcyBwZXIgZGVmYXVsdDwvc3Bhbj48L3NwYW4+CjxzcGFuIGlkPSJjYjEtMyI+PGEgaHJlZj0iI2NiMS0zIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTQiPjxhIGhyZWY9IiNjYjEtNCIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjxzcGFuIGNsYXNzPSJjbyI+IyBTcGVjaWZ5IG1ldHJpY3M8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTUiPjxhIGhyZWY9IiNjYjEtNSIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPm1ldHIgPHNwYW4gY2xhc3M9Im90Ij4mbHQ7LTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5tZXRyaWNfc2V0PC9zcGFuPihyb2NfYXVjLCBicmllcl9jbGFzcyk8L3NwYW4+CjxzcGFuIGlkPSJjYjEtNiI+PGEgaHJlZj0iI2NiMS02IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTciPjxhIGhyZWY9IiNjYjEtNyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjxzcGFuIGNsYXNzPSJjbyI+IyBTYXZlIHByZWRpY3Rpb25zPC9zcGFuPjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS04Ij48YSBocmVmPSIjY2IxLTgiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5jdHJsIDxzcGFuIGNsYXNzPSJvdCI+Jmx0Oy08L3NwYW4+IDxzcGFuIGNsYXNzPSJmdSI+Y29udHJvbF9yZXNhbXBsZXM8L3NwYW4+KDxzcGFuIGNsYXNzPSJhdCI+c2F2ZV9wcmVkID08L3NwYW4+IDxzcGFuIGNsYXNzPSJjbiI+VFJVRTwvc3Bhbj4pPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTkiPjxhIGhyZWY9IiNjYjEtOSIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0xMCI+PGEgaHJlZj0iI2NiMS0xMCIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjxzcGFuIGNsYXNzPSJjbyI+IyBNb2RlbCB3b3JrZmxvdzwvc3Bhbj48L3NwYW4+CjxzcGFuIGlkPSJjYjEtMTEiPjxhIGhyZWY9IiNjYjEtMTEiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT5iYXllc193ZmxvdyA8c3BhbiBjbGFzcz0ib3QiPiZsdDstPC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPndvcmtmbG93PC9zcGFuPigpIDxzcGFuIGNsYXNzPSJzYyI+JSZndDslPC9zcGFuPjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0xMiI+PGEgaHJlZj0iI2NiMS0xMiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgPHNwYW4gY2xhc3M9ImZ1Ij5hZGRfZm9ybXVsYTwvc3Bhbj4oY2xhc3MgPHNwYW4gY2xhc3M9InNjIj5+PC9zcGFuPiAuKSA8c3BhbiBjbGFzcz0ic2MiPiUmZ3Q7JTwvc3Bhbj48L3NwYW4+CjxzcGFuIGlkPSJjYjEtMTMiPjxhIGhyZWY9IiNjYjEtMTMiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4gIDxzcGFuIGNsYXNzPSJmdSI+YWRkX21vZGVsPC9zcGFuPig8c3BhbiBjbGFzcz0iZnUiPm5haXZlX0JheWVzPC9zcGFuPigpKTwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0xNCI+PGEgaHJlZj0iI2NiMS0xNCIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0xNSI+PGEgaHJlZj0iI2NiMS0xNSIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPjxzcGFuIGNsYXNzPSJjbyI+IyBGaXQgcmVzYW1wbGVzPC9zcGFuPjwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0xNiI+PGEgaHJlZj0iI2NiMS0xNiIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPmJheWVzX3JlcyA8c3BhbiBjbGFzcz0ib3QiPiZsdDstPC9zcGFuPiA8c3BhbiBjbGFzcz0iZnUiPmZpdF9yZXNhbXBsZXM8L3NwYW4+KDwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0xNyI+PGEgaHJlZj0iI2NiMS0xNyIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgPHNwYW4gY2xhc3M9ImF0Ij5vYmplY3QgPTwvc3Bhbj4gYmF5ZXNfd2Zsb3csPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTE4Ij48YSBocmVmPSIjY2IxLTE4IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+ICA8c3BhbiBjbGFzcz0iYXQiPm1ldHJpY3MgPTwvc3Bhbj4gbWV0ciw8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMTkiPjxhIGhyZWY9IiNjYjEtMTkiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4gIDxzcGFuIGNsYXNzPSJhdCI+cmVzYW1wbGVzID08L3NwYW4+IGNlbGxzX2N2LDwvc3Bhbj4KPHNwYW4gaWQ9ImNiMS0yMCI+PGEgaHJlZj0iI2NiMS0yMCIgYXJpYS1oaWRkZW49InRydWUiIHRhYmluZGV4PSItMSI+PC9hPiAgPHNwYW4gY2xhc3M9ImF0Ij5jb250cm9sID08L3NwYW4+IGN0cmw8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMjEiPjxhIGhyZWY9IiNjYjEtMjEiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT4pPC9zcGFuPgo8c3BhbiBpZD0iY2IxLTIyIj48YSBocmVmPSIjY2IxLTIyIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTIzIj48YSBocmVmPSIjY2IxLTIzIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImNvIj4jIENhbGlicmF0ZSBlYWNoIG9mIHRoZSBtb2RlbHM8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTI0Ij48YSBocmVmPSIjY2IxLTI0IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+YmV0YV92YWwgPHNwYW4gY2xhc3M9Im90Ij4mbHQ7LTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImZ1Ij5jYWxfdmFsaWRhdGVfYmV0YTwvc3Bhbj4oYmF5ZXNfcmVzLCA8c3BhbiBjbGFzcz0iYXQiPm1ldHJpY3MgPTwvc3Bhbj4gbWV0ciwgPHNwYW4gY2xhc3M9ImF0Ij5zYXZlX3ByZWQgPTwvc3Bhbj4gPHNwYW4gY2xhc3M9ImNuIj5UUlVFPC9zcGFuPik8L3NwYW4+CjxzcGFuIGlkPSJjYjEtMjUiPjxhIGhyZWY9IiNjYjEtMjUiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT48L3NwYW4+CjxzcGFuIGlkPSJjYjEtMjYiPjxhIGhyZWY9IiNjYjEtMjYiIGFyaWEtaGlkZGVuPSJ0cnVlIiB0YWJpbmRleD0iLTEiPjwvYT48c3BhbiBjbGFzcz0iY28iPiMgRXZhbHVhdGUgY2FsaWJyYXRlZCBtb2RlbHM8L3NwYW4+PC9zcGFuPgo8c3BhbiBpZD0iY2IxLTI3Ij48YSBocmVmPSIjY2IxLTI3IiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGFiaW5kZXg9Ii0xIj48L2E+PHNwYW4gY2xhc3M9ImZ1Ij5jb2xsZWN0X21ldHJpY3M8L3NwYW4+KGJldGFfdmFsKTwvc3Bhbj48L2NvZGU+PC9wcmU+PC9kaXY+CjxkaXYgY2xhc3M9ImNlbGwtb3V0cHV0IGNlbGwtb3V0cHV0LXN0ZG91dCI+CjxwcmU+PGNvZGU+IyBBIHRpYmJsZTogNCDDlyA3CiAgLm1ldHJpYyAgICAgLnR5cGUgICAgICAgIC5lc3RpbWF0b3IgIG1lYW4gICAgIG4gc3RkX2VyciAuY29uZmlnCiAgJmx0O2NociZndDsgICAgICAgJmx0O2NociZndDsgICAgICAgICZsdDtjaHImZ3Q7ICAgICAgJmx0O2RibCZndDsgJmx0O2ludCZndDsgICAmbHQ7ZGJsJmd0OyAmbHQ7Y2hyJmd0OyAgCjEgYnJpZXJfY2xhc3MgdW5jYWxpYnJhdGVkIGJpbmFyeSAgICAgMC4yMTAgICAgMTAgMC4wMTExICBjb25maWcgCjIgcm9jX2F1YyAgICAgdW5jYWxpYnJhdGVkIGJpbmFyeSAgICAgMC44NDkgICAgMTAgMC4wMTMzICBjb25maWcgCjMgYnJpZXJfY2xhc3MgY2FsaWJyYXRlZCAgIGJpbmFyeSAgICAgMC4xNDkgICAgMTAgMC4wMDYwMiBjb25maWcgCjQgcm9jX2F1YyAgICAgY2FsaWJyYXRlZCAgIGJpbmFyeSAgICAgMC44NDkgICAgMTAgMC4wMTMyICBjb25maWcgPC9jb2RlPjwvcHJlPgo8L2Rpdj4KPC9kaXY+"></div></div>
</div>
</div>
</div>
</div>
<p>Let’s inspect the calibration plot:</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_predictions</span>(beta_val) <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.type <span class="sc">==</span> <span class="st">"calibrated"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cal_plot_breaks</span>(<span class="at">truth =</span> class, <span class="at">estimate =</span> .pred_PS, <span class="at">num_breaks =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Beta calibration"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
<p>In this exercise sheet we learned how to fit a classification model on a training task and how to assess its performance on unseen test data with the help of <code>tidymodels</code>. We showed how to split data manually into training and test data, and use <code>probably</code> to assess if a model is calibrated. We discussed how Platt scaling/logistic calibration and isotonic regression can be used to improve calibration (although not perfectly calibrate the model here). Also note that in a real-world scenario, we would have wanted to refit the Naive Bayes classifier on the combined train-validate data once we have calibrated it, to mirror nested resampling and reduce bias. This tutorial is a modified version of the <a href="https://www.tidymodels.org/learn/models/calibration/">tidymodels introduction to calibration</a>, used under <a href="https://github.com/tidymodels/tidymodels.org/">CC BY-SA license</a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/mlr-org\.com\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Created with <i class="bi bi-heart-fill"></i> for #rstats.</p>
</div>   
    <div class="nav-footer-center">
<p>CC BY SA 4.0</p>
</div>
    <div class="nav-footer-right">
<p>Website powered by <a href="https://quarto.org/">quarto</a> and <a href="https://www.netlify.com/">Netlify</a>.</p>
</div>
  </div>
</footer>




</body></html>